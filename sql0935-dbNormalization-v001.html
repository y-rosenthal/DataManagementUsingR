<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>40&nbsp; 40.  Database Normalization – Data Management With R (latest version)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./sql3000-sqlQuestions-v001.html" rel="next">
<link href="./sql0950-workingWithDatabasesInR-v010.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-dcbfc57d77cecfb36a223989b6e6cd2b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<script src="yrstuff-v001.js"></script>


<link rel="stylesheet" href="yrStyles-main-v001.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sql0014-theBooksDatabase-v001.html">Relational databases and SQL</a></li><li class="breadcrumb-item"><a href="./sql0935-dbNormalization-v001.html"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title"><yrchapternumber>40. </yrchapternumber> Database Normalization</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Management With R (latest version)</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><yrchapternumber></yrchapternumber> Intro</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Some computer basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro00100-operatingSystems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title"><yrchapternumber>1. </yrchapternumber> What is an "operating system"</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro00120-files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><yrchapternumber>2. </yrchapternumber> Working with files</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Intro to Bash</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000006-bash-externalResources-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><yrchapternumber>3. </yrchapternumber> Intro to Bash - external resources</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000011-WhatIsACli-v010.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><yrchapternumber>4. </yrchapternumber> Intro to Command Line Interfaces (CLIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000013-HowToRunTheBashShellCli-v011.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title"><yrchapternumber>5. </yrchapternumber> How to run the Bash Shell</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000025-introToBash-v007.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title"><yrchapternumber>6. </yrchapternumber> Working with the Bash Shell.</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Into to Coding With AI</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ai-000100-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><yrchapternumber>7. </yrchapternumber> AI in Everyday Use</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aiCoding00100-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title"><yrchapternumber>8. </yrchapternumber> Coding with AI - an overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro00130-chromeExtensions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><yrchapternumber>9. </yrchapternumber> Using AI to code a Chrome Extensions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Intro to R packages</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000022-InstallingRPackages-v003.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><yrchapternumber>10. </yrchapternumber> Intro to R packages</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Intro to Quarto</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000017-introToQuarto-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title"><yrchapternumber>11. </yrchapternumber> Intro to Quarto</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Intro to tidyverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0400050-whatIsTidyverse-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title"><yrchapternumber>12. </yrchapternumber> What is the "tidyverse"</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0400050-tibbles-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title"><yrchapternumber>13. </yrchapternumber> tibbles and tribbles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0400100-usingPipes-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title"><yrchapternumber>14. </yrchapternumber> Using pipes, i.e. %&gt;% and |&gt;</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0400200-stringr-tutorials-v003.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title"><yrchapternumber>15. </yrchapternumber> stringr tutorial</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Working with files</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000055-workingWithFiles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title"><yrchapternumber>16. </yrchapternumber> Working with files</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">JSON data and APIs</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000075-whatIsJsonData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title"><yrchapternumber>17. </yrchapternumber> Intro to JSON data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000080-editingAndValidatingJsonFiles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title"><yrchapternumber>18. </yrchapternumber> Creating, editing and validating JSON files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000085-jsonDataTypes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title"><yrchapternumber>19. </yrchapternumber> DATA TYPES IN JSON</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000090-usingJsonInR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title"><yrchapternumber>20. </yrchapternumber> Using JSON in R with jsonlite package</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000093-jsonParsingPractice-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title"><yrchapternumber>21. </yrchapternumber> JSON Parsing Practice in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment-api-0000100-weatherDataApi-v002.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title"><yrchapternumber>22. </yrchapternumber> assignment - weather API</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Regular Expressions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0200200-a-introToRegularExpressions-v036.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title"><yrchapternumber>23. </yrchapternumber> regular expressions (regex)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./000260-PracticeWithRegulaExpressions-v003.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title"><yrchapternumber>24. </yrchapternumber> Practice with Regular Expressions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0990100-cleaningData-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title"><yrchapternumber>25. </yrchapternumber> "Cleaning" data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Intro to dplyr</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0500100-a-tdyvrsDplyr-v005.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title"><yrchapternumber>26. </yrchapternumber> dplyr - getting and viewing the data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0500100-b-tdyvrsDplyr-v005.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title"><yrchapternumber>27. </yrchapternumber> dplyr verbs - select, filter, etc.</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true">
 <span class="menu-text">Relational databases and SQL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0014-theBooksDatabase-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title"><yrchapternumber>28. </yrchapternumber> Get the data - "books database" and other tables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0006-introToDatabases-v023.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title"><yrchapternumber>29. </yrchapternumber>  "databases" and "database management systems"</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0500400-sqlSelectIntro-v003.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title"><yrchapternumber>30. </yrchapternumber> Intro to SQL Select ***(assumes some knowledge of dplyr)***</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0010-introToSql-v023.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title"><yrchapternumber>31. </yrchapternumber> Intro to Relational Databases and SQL ***(no dplyr required)***</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0035-workingWithMultipleTables-v012.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title"><yrchapternumber>32. </yrchapternumber> Inner Joins.</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0030-sqlFunctions_aggregateFunctions_groupBy_having-v019.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title"><yrchapternumber>33. </yrchapternumber> aggregate functions, group by, having</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0040-crossJoin-leftJoin-subquery-selfJoins-v023.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title"><yrchapternumber>34. </yrchapternumber> more joins (cross/left/right/full), subqueries, set operations, case, self joins</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0050-commonTableExpressions-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title"><yrchapternumber>35. </yrchapternumber> Common Table Expressions (CTE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0200-otherSqlCommands-v002.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title"><yrchapternumber>36. </yrchapternumber> other commands: update/delete, create/drop/insert</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0900-sqlWindowFunctions-v002.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title"><yrchapternumber>37. </yrchapternumber> SQL "window" functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0915-workingWithSqliteDatabasesInR-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title"><yrchapternumber>38. </yrchapternumber> Working with SQLite databases in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0950-workingWithDatabasesInR-v010.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title"><yrchapternumber>39. </yrchapternumber> Working directly with databases in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql0935-dbNormalization-v001.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title"><yrchapternumber>40. </yrchapternumber> Database Normalization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql3000-sqlQuestions-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title"><yrchapternumber>41. </yrchapternumber> Database Questions (and Answers)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true">
 <span class="menu-text">Web Scraping</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./web-000205-introToXml-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title"><yrchapternumber>42. </yrchapternumber> Intro to XML</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./web-000220-parsingXmUsingR-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title"><yrchapternumber>43. </yrchapternumber> Parsing XML using R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./web-000300-internetArchitecture-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title"><yrchapternumber>44. </yrchapternumber> How a webpage gets to your browser</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./web-000325-introToHtmlAndCss-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title"><yrchapternumber>45. </yrchapternumber> Introduction to HTML and CSS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./web-000400-webscrapingContinued-015.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title"><yrchapternumber>46. </yrchapternumber> Web Scraping with R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./web-000130-WebscrapingJavascriptSites-v004.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title"><yrchapternumber>47. </yrchapternumber> Scraping Dynamic (JavaScript) Websites</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./web-000420-practiceWithWebScraping-v001-ANSWERS-v002.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title"><yrchapternumber>48. </yrchapternumber> CSS Selector Questions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="true">
 <span class="menu-text">Git and Github</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./github-000700-markdownGithubVsQuarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title"><yrchapternumber>49. </yrchapternumber> GitHub Markdown vs. Quarto (.qmd) Comparison</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="true">
 <span class="menu-text">visualizations with ggplot2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./050050-tdyvrsGgplot2-v0001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title"><yrchapternumber>50. </yrchapternumber> Intro to ggplot2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-15" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000100-topics-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">51</span>&nbsp; <span class="chapter-title"><yrchapternumber>51. </yrchapternumber> Topics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000200-bibliography-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">52</span>&nbsp; <span class="chapter-title"><yrchapternumber>52. </yrchapternumber> Bibliography</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000300-whereToFindDatasets-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">53</span>&nbsp; <span class="chapter-title"><yrchapternumber>53. </yrchapternumber> Where to find datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0000310-whereToFindApis-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">54</span>&nbsp; <span class="chapter-title"><yrchapternumber>54. </yrchapternumber> Where to find APIs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0999000-toDo-v001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">55</span>&nbsp; <span class="chapter-title"><yrchapternumber>55. </yrchapternumber> Additional topics</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#normal-forms" id="toc-normal-forms" class="nav-link active" data-scroll-target="#normal-forms"><span class="header-section-number">40.1</span> Normal Forms</a></li>
  <li><a href="#first-normal-form-1nf" id="toc-first-normal-form-1nf" class="nav-link" data-scroll-target="#first-normal-form-1nf"><span class="header-section-number">40.2</span> First Normal Form (1NF)</a>
  <ul class="collapse">
  <li><a href="#converting-the-data-to-1nf" id="toc-converting-the-data-to-1nf" class="nav-link" data-scroll-target="#converting-the-data-to-1nf"><span class="header-section-number">40.2.1</span> Converting the data to 1NF</a></li>
  </ul></li>
  <li><a href="#example---college-class-offerings" id="toc-example---college-class-offerings" class="nav-link" data-scroll-target="#example---college-class-offerings"><span class="header-section-number">40.3</span> Example - college class offerings</a>
  <ul class="collapse">
  <li><a href="#all-data-in-a-single-table" id="toc-all-data-in-a-single-table" class="nav-link" data-scroll-target="#all-data-in-a-single-table"><span class="header-section-number">40.3.1</span> All data in a single table</a></li>
  <li><a href="#normalize-tables-to-reduce-duplication-of-data" id="toc-normalize-tables-to-reduce-duplication-of-data" class="nav-link" data-scroll-target="#normalize-tables-to-reduce-duplication-of-data"><span class="header-section-number">40.3.2</span> “Normalize” tables to reduce duplication of data</a></li>
  <li><a href="#split-professor-data-into-a-different-table" id="toc-split-professor-data-into-a-different-table" class="nav-link" data-scroll-target="#split-professor-data-into-a-different-table"><span class="header-section-number">40.3.3</span> split professor data into a different table</a></li>
  <li><a href="#split-common-class-info-into-a-different-table" id="toc-split-common-class-info-into-a-different-table" class="nav-link" data-scroll-target="#split-common-class-info-into-a-different-table"><span class="header-section-number">40.3.4</span> Split common class info into a different table</a></li>
  </ul></li>
  <li><a href="#nf-and-3nf-formal-rules-for-how-to-split-a-table-into-multiple-tables-to-avoid-duplicated-data" id="toc-nf-and-3nf-formal-rules-for-how-to-split-a-table-into-multiple-tables-to-avoid-duplicated-data" class="nav-link" data-scroll-target="#nf-and-3nf-formal-rules-for-how-to-split-a-table-into-multiple-tables-to-avoid-duplicated-data"><span class="header-section-number">40.4</span> 2NF and 3NF: Formal rules for how to split a table into multiple tables to avoid duplicated data</a>
  <ul class="collapse">
  <li><a href="#what-is-a-functional-dependency-fd" id="toc-what-is-a-functional-dependency-fd" class="nav-link" data-scroll-target="#what-is-a-functional-dependency-fd"><span class="header-section-number">40.4.1</span> What is a Functional Dependency (FD)</a></li>
  <li><a href="#functional-dependency-rules-x-y-a-b-c" id="toc-functional-dependency-rules-x-y-a-b-c" class="nav-link" data-scroll-target="#functional-dependency-rules-x-y-a-b-c"><span class="header-section-number">40.4.2</span> Functional Dependency Rules: <code>X, Y → A, B, C</code></a></li>
  <li><a href="#example-table-studentcourse" id="toc-example-table-studentcourse" class="nav-link" data-scroll-target="#example-table-studentcourse"><span class="header-section-number">40.4.3</span> Example Table: StudentCourse</a></li>
  </ul></li>
  <li><a href="#primary-key-pk-candidate-pk-composite-pk" id="toc-primary-key-pk-candidate-pk-composite-pk" class="nav-link" data-scroll-target="#primary-key-pk-candidate-pk-composite-pk"><span class="header-section-number">40.5</span> Primary Key (PK), candidate PK, composite PK</a></li>
  <li><a href="#new-example---to-demo-2nf-and-3nf" id="toc-new-example---to-demo-2nf-and-3nf" class="nav-link" data-scroll-target="#new-example---to-demo-2nf-and-3nf"><span class="header-section-number">40.6</span> New example - to demo 2NF and 3NF</a>
  <ul class="collapse">
  <li><a href="#the-functional-dependencies-and-primary-key" id="toc-the-functional-dependencies-and-primary-key" class="nav-link" data-scroll-target="#the-functional-dependencies-and-primary-key"><span class="header-section-number">40.6.1</span> The functional dependencies and primary key</a></li>
  </ul></li>
  <li><a href="#second-normal-form-2nf" id="toc-second-normal-form-2nf" class="nav-link" data-scroll-target="#second-normal-form-2nf"><span class="header-section-number">40.7</span> Second Normal Form (2NF)</a>
  <ul class="collapse">
  <li><a href="#what-is-a-partial-functional-dependency-pfd" id="toc-what-is-a-partial-functional-dependency-pfd" class="nav-link" data-scroll-target="#what-is-a-partial-functional-dependency-pfd"><span class="header-section-number">40.7.1</span> What is a “Partial Functional Dependency (pFD)” ?</a></li>
  <li><a href="#general-rules-for-how-to-convert-a-table-to-2nf" id="toc-general-rules-for-how-to-convert-a-table-to-2nf" class="nav-link" data-scroll-target="#general-rules-for-how-to-convert-a-table-to-2nf"><span class="header-section-number">40.7.2</span> General rules for how to convert a table to 2NF</a></li>
  </ul></li>
  <li><a href="#third-normal-form-3nf" id="toc-third-normal-form-3nf" class="nav-link" data-scroll-target="#third-normal-form-3nf"><span class="header-section-number">40.8</span> Third Normal Form (3NF)</a>
  <ul class="collapse">
  <li><a href="#what-is-a-transitive-functional-dependency-tfd" id="toc-what-is-a-transitive-functional-dependency-tfd" class="nav-link" data-scroll-target="#what-is-a-transitive-functional-dependency-tfd"><span class="header-section-number">40.8.1</span> What is a “Transitive Functional Dependency (tFD)” ?</a></li>
  <li><a href="#convert-the-courses-table-to-be-in-3nf" id="toc-convert-the-courses-table-to-be-in-3nf" class="nav-link" data-scroll-target="#convert-the-courses-table-to-be-in-3nf"><span class="header-section-number">40.8.2</span> Convert the Courses table to be in 3NF</a></li>
  </ul></li>
  <li><a href="#the-final-design-of-all-tables-i.e.-the-final-table-schema" id="toc-the-final-design-of-all-tables-i.e.-the-final-table-schema" class="nav-link" data-scroll-target="#the-final-design-of-all-tables-i.e.-the-final-table-schema"><span class="header-section-number">40.9</span> The final design of all tables (i.e.&nbsp;the final table “schema”)</a>
  <ul class="collapse">
  <li><a href="#general-rules-for-how-to-convert-a-table-to-3nf" id="toc-general-rules-for-how-to-convert-a-table-to-3nf" class="nav-link" data-scroll-target="#general-rules-for-how-to-convert-a-table-to-3nf"><span class="header-section-number">40.9.1</span> General rules for how to convert a table to 3NF</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./sql0014-theBooksDatabase-v001.html">Relational databases and SQL</a></li><li class="breadcrumb-item"><a href="./sql0935-dbNormalization-v001.html"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title"><yrchapternumber>40. </yrchapternumber> Database Normalization</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title"><yrchapternumber>40. </yrchapternumber> Database Normalization</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- YR NOTES
The original document was generated by Claude.ai
URL: https://claude.ai/chat/51cc0cc9-d045-4e7e-8ccc-347c55fa45c3
TOPIC: Normalization Examples for Database Course
-->
<p>The same data can be arranged in a database in many different ways. This section describes how to intelligently arrange your data in a relational database.</p>
<p><strong>Database normalization</strong> is the process of designing database tables so that</p>
<ul>
<li><p>they are in good form for manipulating with SQL (this the focus of “1st normal form” - see below)</p></li>
<li><p>there is minimal repetition of data (this is the focus of “2nd normal form” and “3rd normal form” - see below)</p></li>
</ul>
<section id="normal-forms" class="level2" data-number="40.1">
<h2 data-number="40.1" class="anchored" data-anchor-id="normal-forms"><span class="header-section-number">40.1</span> Normal Forms</h2>
<p>Database normalization is accomplished in several steps. There are different “levels” of normalization, each level progressing towards a more perfect organization of the data. Each level is called a “Normal Form”. We say that a database is “in” a particular normal form when the tables are structured in a way that conforms to the rules of that normal form. This will all become much more clear as you progress through the material below. In a <strong><em>fully normalized database</em></strong> the only data that should be repeated are the primary/foreign keys.</p>
<p>The following are the various normal forms. You are not expected to understand the technical terms in the list below. These will be covered in the material that follows this section.</p>
<ul>
<li>1NF (1st Normal Form) - only atomic values in columns, no repeating groups or arrays</li>
<li>2NF (2nd Normal Form) - no “partial functional dependencies (pFD)”</li>
<li>3NF (3rd Normal Form) - no “transitive functional dependencies (tFD)”</li>
</ul>
<p>Most database designers aim to have their databases at least in 3rd Normal Form. However, the following additional normal forms are used to further “normalize” a database to deal with special cases.</p>
<p>In this material we will only be covering 1st, 2nd and 3rd normal forms. The list below is provided in case you want to do your own research.</p>
<ul>
<li>Bocye-Codd Normal Form (BCNF) - every determinant (attribute that determines other attributes) must be a candidate key</li>
<li>4NF - no multi-valued dependencies</li>
<li>5NF - tables cannot be losslessly decomposed into smaller tables</li>
<li>6NF - tables must be irreducible, containing no non-trivial join dependencies</li>
</ul>
</section>
<section id="first-normal-form-1nf" class="level2" data-number="40.2">
<h2 data-number="40.2" class="anchored" data-anchor-id="first-normal-form-1nf"><span class="header-section-number">40.2</span> First Normal Form (1NF)</h2>
<p>First normal form requires that</p>
<ul>
<li><p>There be only one value in each “cell” of a table.<br>
(AKA “all attributes contain only atomic values”)</p></li>
<li><p>There should NOT be multiple columns for the same type of data<br>
(AKA There are no “repeating groups”.)</p></li>
</ul>
<p>The following tables are <strong><em>not</em></strong> in 1st normal form (1NF).</p>
<ul>
<li><p>This table contains multiple values in a single cell which violates the rules of 1NF</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>orders</caption>
<thead>
<tr class="header">
<th style="text-align: left;">orderNum</th>
<th style="text-align: left;">products</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ord100</td>
<td style="text-align: left;">3 apples, 2 plums</td>
</tr>
<tr class="even">
<td style="text-align: left;">ord200</td>
<td style="text-align: left;">5 apples, 3 pears, 10 plums</td>
</tr>
</tbody>
</table>
</div>
</div></li>
<li><p>This table contains multiple columns for similar types of data. This also violates the rules of 1NF.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>orders</caption>
<colgroup>
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 16%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">orderNum</th>
<th style="text-align: left;">product1</th>
<th style="text-align: right;">quantity1</th>
<th style="text-align: left;">product2</th>
<th style="text-align: right;">quantity2</th>
<th style="text-align: left;">product1.1</th>
<th style="text-align: left;">quantity3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ord100</td>
<td style="text-align: left;">apples</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">plums</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">NULL</td>
<td style="text-align: left;">NULL</td>
</tr>
<tr class="even">
<td style="text-align: left;">ord200</td>
<td style="text-align: left;">apples</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">pears</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">plums</td>
<td style="text-align: left;">10</td>
</tr>
</tbody>
</table>
</div>
</div></li>
</ul>
<section id="converting-the-data-to-1nf" class="level3" data-number="40.2.1">
<h3 data-number="40.2.1" class="anchored" data-anchor-id="converting-the-data-to-1nf"><span class="header-section-number">40.2.1</span> Converting the data to 1NF</h3>
<p>The following table contains the same data in first normal form:</p>
<p>::: {.cell} ::: {.cell-output-display}</p>
<table class="caption-top table">
<caption>orders</caption>
<thead>
<tr class="header">
<th style="text-align: left;">orderNum</th>
<th style="text-align: left;">product</th>
<th style="text-align: right;">quantity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ord100</td>
<td style="text-align: left;">apples</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">ord100</td>
<td style="text-align: left;">plums</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ord200</td>
<td style="text-align: left;">apples</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">ord200</td>
<td style="text-align: left;">pears</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ord200</td>
<td style="text-align: left;">plums</td>
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table>
<p>::: :::</p>
</section>
</section>
<section id="example---college-class-offerings" class="level2" data-number="40.3">
<h2 data-number="40.3" class="anchored" data-anchor-id="example---college-class-offerings"><span class="header-section-number">40.3</span> Example - college class offerings</h2>
<p>The data shown below about classes, sections and professors can be arranged in many different formats.</p>
<section id="all-data-in-a-single-table" class="level3" data-number="40.3.1">
<h3 data-number="40.3.1" class="anchored" data-anchor-id="all-data-in-a-single-table"><span class="header-section-number">40.3.1</span> All data in a single table</h3>
<p>For example, the following data could be in a single table. This makes it very easy for people to read the info.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>classOfferings</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 11%">
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">className</th>
<th style="text-align: left;">classNum</th>
<th style="text-align: right;">credits</th>
<th style="text-align: right;">section</th>
<th style="text-align: left;">room</th>
<th style="text-align: left;">professor</th>
<th style="text-align: left;">office</th>
<th style="text-align: left;">email</th>
<th style="text-align: left;">tel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">231</td>
<td style="text-align: left;">F201</td>
<td style="text-align: left;">joe jones</td>
<td style="text-align: left;">B102</td>
<td style="text-align: left;">joe@abc.edu</td>
<td style="text-align: left;">(212)555-5555</td>
</tr>
<tr class="even">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">241</td>
<td style="text-align: left;">F201</td>
<td style="text-align: left;">joe jones</td>
<td style="text-align: left;">B102</td>
<td style="text-align: left;">joe@abc.edu</td>
<td style="text-align: left;">(212)555-5555</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">F310</td>
<td style="text-align: left;">sue smith</td>
<td style="text-align: left;">B231</td>
<td style="text-align: left;">sue@abc.edu</td>
<td style="text-align: left;">(212)999-9999</td>
</tr>
<tr class="even">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">341</td>
<td style="text-align: left;">F310</td>
<td style="text-align: left;">sue smith</td>
<td style="text-align: left;">B231</td>
<td style="text-align: left;">sue@abc.edu</td>
<td style="text-align: left;">(212)999-9999</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Database Design</td>
<td style="text-align: left;">IDS2040</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">133</td>
<td style="text-align: left;">F250</td>
<td style="text-align: left;">joe jones</td>
<td style="text-align: left;">B102</td>
<td style="text-align: left;">joe@abc.edu</td>
<td style="text-align: left;">(212)555-5555</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="normalize-tables-to-reduce-duplication-of-data" class="level3" data-number="40.3.2">
<h3 data-number="40.3.2" class="anchored" data-anchor-id="normalize-tables-to-reduce-duplication-of-data"><span class="header-section-number">40.3.2</span> “Normalize” tables to reduce duplication of data</h3>
<p>If you look closely at the data in the example above, you’ll notice that the details for each professor (i.e.&nbsp;name, office, email, tel) is duplicated in multiple rows. This makes it very easy for people to read the data. However, this is NOT a great way to store information in a relational database (keep reading).</p>
<p>Having the same data in more than one place in a database can lead to inconsistencies in the data. For example if a database records a person’s name in more than one place and the person changes their name, then all copies of the person’s name would need to be updated. If due to some miscalculation, some copies of the person’s name were updated and some weren’t updated, the database would be inconsistent. One of the major goals of a good database design is to eliminate redundant data. All data, other than primary keys and foreign keys, should be recorded in one and only one place in the database.</p>
</section>
<section id="split-professor-data-into-a-different-table" class="level3" data-number="40.3.3">
<h3 data-number="40.3.3" class="anchored" data-anchor-id="split-professor-data-into-a-different-table"><span class="header-section-number">40.3.3</span> split professor data into a different table</h3>
<p>The data shown above can be reorganized into the following structure to avoid duplicating each professor’s details.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>offerings</caption>
<thead>
<tr class="header">
<th style="text-align: left;">className</th>
<th style="text-align: left;">classNum</th>
<th style="text-align: right;">credits</th>
<th style="text-align: right;">section</th>
<th style="text-align: left;">room</th>
<th style="text-align: left;">prof_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">231</td>
<td style="text-align: left;">F201</td>
<td style="text-align: left;">P100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">241</td>
<td style="text-align: left;">F201</td>
<td style="text-align: left;">P100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">F310</td>
<td style="text-align: left;">P200</td>
</tr>
<tr class="even">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">341</td>
<td style="text-align: left;">F310</td>
<td style="text-align: left;">P200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Database Design</td>
<td style="text-align: left;">IDS2040</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">133</td>
<td style="text-align: left;">F250</td>
<td style="text-align: left;">P100</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>professors</caption>
<thead>
<tr class="header">
<th style="text-align: left;">prof_id</th>
<th style="text-align: left;">first</th>
<th style="text-align: left;">last</th>
<th style="text-align: left;">office</th>
<th style="text-align: left;">email</th>
<th style="text-align: left;">tel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">P100</td>
<td style="text-align: left;">joe</td>
<td style="text-align: left;">jones</td>
<td style="text-align: left;">B102</td>
<td style="text-align: left;">joe@abc.edu</td>
<td style="text-align: left;">(212)555-5555</td>
</tr>
<tr class="even">
<td style="text-align: left;">P200</td>
<td style="text-align: left;">sue</td>
<td style="text-align: left;">smith</td>
<td style="text-align: left;">B231</td>
<td style="text-align: left;">sue@abc.edu</td>
<td style="text-align: left;">(212)999-9999</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="sql-select-to-regenerate-original-all-in-one-table" class="level4">
<h4 class="anchored" data-anchor-id="sql-select-to-regenerate-original-all-in-one-table">SQL SELECT to regenerate original “all in one” table</h4>
<p>We are able to see the data as it was originally presented by using the following SQL query:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>queryResults <span class="ot">=</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="st">    select className, classNum, credits, section, room, first || ' ' || last as professor, office, email, tel</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">    from offerings join professors on offerings.prof_id = professors.prof_id</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="st">    order by classNum, section</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="st">  "</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(queryResults, <span class="at">caption =</span> <span class="st">"queryResults"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>queryResults</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 11%">
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">className</th>
<th style="text-align: left;">classNum</th>
<th style="text-align: right;">credits</th>
<th style="text-align: right;">section</th>
<th style="text-align: left;">room</th>
<th style="text-align: left;">professor</th>
<th style="text-align: left;">office</th>
<th style="text-align: left;">email</th>
<th style="text-align: left;">tel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">231</td>
<td style="text-align: left;">F201</td>
<td style="text-align: left;">joe jones</td>
<td style="text-align: left;">B102</td>
<td style="text-align: left;">joe@abc.edu</td>
<td style="text-align: left;">(212)555-5555</td>
</tr>
<tr class="even">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">241</td>
<td style="text-align: left;">F201</td>
<td style="text-align: left;">joe jones</td>
<td style="text-align: left;">B102</td>
<td style="text-align: left;">joe@abc.edu</td>
<td style="text-align: left;">(212)555-5555</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">F310</td>
<td style="text-align: left;">sue smith</td>
<td style="text-align: left;">B231</td>
<td style="text-align: left;">sue@abc.edu</td>
<td style="text-align: left;">(212)999-9999</td>
</tr>
<tr class="even">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">341</td>
<td style="text-align: left;">F310</td>
<td style="text-align: left;">sue smith</td>
<td style="text-align: left;">B231</td>
<td style="text-align: left;">sue@abc.edu</td>
<td style="text-align: left;">(212)999-9999</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Database Design</td>
<td style="text-align: left;">IDS2040</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">133</td>
<td style="text-align: left;">F250</td>
<td style="text-align: left;">joe jones</td>
<td style="text-align: left;">B102</td>
<td style="text-align: left;">joe@abc.edu</td>
<td style="text-align: left;">(212)555-5555</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="split-common-class-info-into-a-different-table" class="level3" data-number="40.3.4">
<h3 data-number="40.3.4" class="anchored" data-anchor-id="split-common-class-info-into-a-different-table"><span class="header-section-number">40.3.4</span> Split common class info into a different table</h3>
<p>The same data can be still further reorganized into the following structure to avoid duplicating the details for each class:</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>classes</caption>
<thead>
<tr class="header">
<th style="text-align: left;">classNum</th>
<th style="text-align: left;">className</th>
<th style="text-align: right;">credits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">IDS1020</td>
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">IDS2040</td>
<td style="text-align: left;">Database Design</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>offerings</caption>
<thead>
<tr class="header">
<th style="text-align: left;">crn</th>
<th style="text-align: left;">classNum</th>
<th style="text-align: right;">section</th>
<th style="text-align: left;">room</th>
<th style="text-align: left;">prof_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">12100</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">231</td>
<td style="text-align: left;">F201</td>
<td style="text-align: left;">P100</td>
</tr>
<tr class="even">
<td style="text-align: left;">12100</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">241</td>
<td style="text-align: left;">F201</td>
<td style="text-align: left;">P100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">12100</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">F310</td>
<td style="text-align: left;">P200</td>
</tr>
<tr class="even">
<td style="text-align: left;">12100</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">341</td>
<td style="text-align: left;">F310</td>
<td style="text-align: left;">P200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">14301</td>
<td style="text-align: left;">IDS2040</td>
<td style="text-align: right;">133</td>
<td style="text-align: left;">F250</td>
<td style="text-align: left;">P100</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>professors</caption>
<thead>
<tr class="header">
<th style="text-align: left;">prof_id</th>
<th style="text-align: left;">first</th>
<th style="text-align: left;">last</th>
<th style="text-align: left;">office</th>
<th style="text-align: left;">email</th>
<th style="text-align: left;">tel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">P100</td>
<td style="text-align: left;">joe</td>
<td style="text-align: left;">jones</td>
<td style="text-align: left;">B102</td>
<td style="text-align: left;">joe@abc.edu</td>
<td style="text-align: left;">(212)555-5555</td>
</tr>
<tr class="even">
<td style="text-align: left;">P200</td>
<td style="text-align: left;">sue</td>
<td style="text-align: left;">smith</td>
<td style="text-align: left;">B231</td>
<td style="text-align: left;">sue@abc.edu</td>
<td style="text-align: left;">(212)999-9999</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="sql-select-to-regenerate-original-all-in-one-table-1" class="level4">
<h4 class="anchored" data-anchor-id="sql-select-to-regenerate-original-all-in-one-table-1">SQL SELECT to regenerate original “all in one” table</h4>
<p>We are able to see the data as it was originally presented by using the following SQL query:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>queryResults <span class="ot">=</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqldf</span>(<span class="st">"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="st">    select className, classes.classNum, credits, section, room, </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">           first || ' ' || last as professor, office, email, tel</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">    from classes join offerings on classes.classNum = offerings.classNum </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">                 join professors on offerings.prof_id = professors.prof_id</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">    order by classes.classNum, section</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="st">  "</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(queryResults, <span class="at">caption =</span> <span class="st">"queryResults"</span>, <span class="at">booktabs=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>queryResults</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 11%">
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">className</th>
<th style="text-align: left;">classNum</th>
<th style="text-align: right;">credits</th>
<th style="text-align: right;">section</th>
<th style="text-align: left;">room</th>
<th style="text-align: left;">professor</th>
<th style="text-align: left;">office</th>
<th style="text-align: left;">email</th>
<th style="text-align: left;">tel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">231</td>
<td style="text-align: left;">F201</td>
<td style="text-align: left;">joe jones</td>
<td style="text-align: left;">B102</td>
<td style="text-align: left;">joe@abc.edu</td>
<td style="text-align: left;">(212)555-5555</td>
</tr>
<tr class="even">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">241</td>
<td style="text-align: left;">F201</td>
<td style="text-align: left;">joe jones</td>
<td style="text-align: left;">B102</td>
<td style="text-align: left;">joe@abc.edu</td>
<td style="text-align: left;">(212)555-5555</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">F310</td>
<td style="text-align: left;">sue smith</td>
<td style="text-align: left;">B231</td>
<td style="text-align: left;">sue@abc.edu</td>
<td style="text-align: left;">(212)999-9999</td>
</tr>
<tr class="even">
<td style="text-align: left;">Intro to IDS</td>
<td style="text-align: left;">IDS1020</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">341</td>
<td style="text-align: left;">F310</td>
<td style="text-align: left;">sue smith</td>
<td style="text-align: left;">B231</td>
<td style="text-align: left;">sue@abc.edu</td>
<td style="text-align: left;">(212)999-9999</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Database Design</td>
<td style="text-align: left;">IDS2040</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">133</td>
<td style="text-align: left;">F250</td>
<td style="text-align: left;">joe jones</td>
<td style="text-align: left;">B102</td>
<td style="text-align: left;">joe@abc.edu</td>
<td style="text-align: left;">(212)555-5555</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
</section>
<section id="nf-and-3nf-formal-rules-for-how-to-split-a-table-into-multiple-tables-to-avoid-duplicated-data" class="level2" data-number="40.4">
<h2 data-number="40.4" class="anchored" data-anchor-id="nf-and-3nf-formal-rules-for-how-to-split-a-table-into-multiple-tables-to-avoid-duplicated-data"><span class="header-section-number">40.4</span> 2NF and 3NF: Formal rules for how to split a table into multiple tables to avoid duplicated data</h2>
<p>The previous section showed an example of how to split a single table into multiple tables in order to avoid duplication of data. We didn’t give formal rules, we just used our intuition for how to do so.</p>
<p>It’s usually pretty straight forward to arrange your data correctly to avoid data duplication. In general think about the the different types of “entities” that your data describes (e.g.&nbsp;courses, students, professors, etc). Then create a different table for each type of entity and relate the tables using PK and FK columns. However, it’s possible to miss obvious issues unless you carefully analyze the data.</p>
<p>This section introduces a formal set of rules for how to split up tables to avoid data duplication. To this end, we will focus on how to put tables into “Second Normal Form (2NF)” and “Third Normal Form (3NF)”. A prerequisite to understanding 2nd and 3rd normal forms is to understand what a “functional dependency (FD)” is.</p>
<section id="what-is-a-functional-dependency-fd" class="level3" data-number="40.4.1">
<h3 data-number="40.4.1" class="anchored" data-anchor-id="what-is-a-functional-dependency-fd"><span class="header-section-number">40.4.1</span> What is a Functional Dependency (FD)</h3>
<p>A <strong>functional dependency</strong> describes a relationship between columns (attributes) in a table.</p>
<p>A functional dependency is a relationship between the columns in a table where the values in one column (or a set of columns) uniquely determines the values in another column. If the value in column A determines the value in column B (denoted as A → B), then for any given value of A, there can only ever be exactly one value of B associated with it. For example, if StudentID → StudentName, then knowing a specific StudentID uniquely identifies the corresponding StudentName.</p>
</section>
<section id="functional-dependency-rules-x-y-a-b-c" class="level3" data-number="40.4.2">
<h3 data-number="40.4.2" class="anchored" data-anchor-id="functional-dependency-rules-x-y-a-b-c"><span class="header-section-number">40.4.2</span> Functional Dependency Rules: <code>X, Y → A, B, C</code></h3>
<p>A functional dependency rule can be written in the following format where A,B,C,D are column names.</p>
<p>A -&gt; B,C,D</p>
<ul>
<li><p>The <strong>left-hand side (LHS)</strong> contains the <strong>determinant(s)</strong> — the column(s) that determine the values of other columns.</p></li>
<li><p>The <strong>right-hand side (RHS)</strong> contains the <strong>dependent</strong> column(s) — the values that are determined.</p></li>
<li><p>Both the left hand side and the right hand side can have any number of columns.</p></li>
</ul>
<p>For example a functional dependency can also take a form similar to:</p>
<p>A,B -&gt; C,D,E</p>
<p>Where the values in columns A and B taken together functionally determine the values of columns C,D and E.</p>
</section>
<section id="example-table-studentcourse" class="level3" data-number="40.4.3">
<h3 data-number="40.4.3" class="anchored" data-anchor-id="example-table-studentcourse"><span class="header-section-number">40.4.3</span> Example Table: StudentCourse</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 21%">
<col style="width: 12%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th>StudentID</th>
<th>FirstName</th>
<th>LastName</th>
<th>CourseID</th>
<th>CourseName</th>
<th>Credits</th>
<th>Grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>001</td>
<td>Alice</td>
<td>Smith</td>
<td>C101</td>
<td>Intro to Math</td>
<td>3</td>
<td>A</td>
</tr>
<tr class="even">
<td>002</td>
<td>Bob</td>
<td>Jones</td>
<td>C101</td>
<td>Intro to Math</td>
<td>3</td>
<td>B</td>
</tr>
<tr class="odd">
<td>001</td>
<td>Alice</td>
<td>Smith</td>
<td>C102</td>
<td>English 101</td>
<td>4</td>
<td>A-</td>
</tr>
</tbody>
</table>
<p>The functional dependencies are:</p>
<ol type="1">
<li><p><code>StudentID → FirstName, LastName</code></p>
<ul>
<li>A student ID uniquely determines the student’s name.</li>
</ul></li>
<li><p><code>CourseID → CourseName, Credits</code></p>
<ul>
<li>A course ID determines the course details.</li>
</ul></li>
<li><p><code>StudentID, CourseID → Grade</code></p>
<ul>
<li>The <strong>composite key</strong> of student and course determines the grade.</li>
</ul></li>
</ol>
</section>
</section>
<section id="primary-key-pk-candidate-pk-composite-pk" class="level2" data-number="40.5">
<h2 data-number="40.5" class="anchored" data-anchor-id="primary-key-pk-candidate-pk-composite-pk"><span class="header-section-number">40.5</span> Primary Key (PK), candidate PK, composite PK</h2>
<p>We simplified the last functional dependency rule a little in order to highlight that StudentId and CourseId determine the Grade value.</p>
<p>However, if you look carefully you should notice that since SudentId determines all of the student related details and CourseId determines all of the Course details, and these are ALL of the columns in the table. We can write that as:</p>
<p><code>StudentID, CourseID → FirstName, LastName, CourseName, Credicts, Grade</code></p>
<p>Since this functional dependency rule includes all of the columns in the table, we say that <code>StudentId, CourseId</code> is a <strong><em>candidate</em></strong> <strong>primary key</strong> for the table. If there would be more than one candidate PK (there isn’t in this table) then one of the candidate PK’s would be chosen as THE primary key for the table.</p>
<p>A Primary Key that is the combination of more than one column is known as a <strong><em>composite</em></strong> <strong>primary key</strong>.</p>
</section>
<section id="new-example---to-demo-2nf-and-3nf" class="level2" data-number="40.6">
<h2 data-number="40.6" class="anchored" data-anchor-id="new-example---to-demo-2nf-and-3nf"><span class="header-section-number">40.6</span> New example - to demo 2NF and 3NF</h2>
<p>Let’s start with a new example.</p>
<p>This example also involves courses in a college. It is similar to the previous example but the data is slightly different. This new example contains information about students, their courses, grades, and detailed department information. Let’s normalize this table step by step.</p>
<p>The table is already in first normal form (see above).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the initial non-normalized table</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>first_normal_form <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">StudentID =</span> <span class="fu">c</span>(<span class="st">"001"</span>, <span class="st">"002"</span>, <span class="st">"001"</span>, <span class="st">"003"</span>, <span class="st">"002"</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">FirstName =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Alice"</span>, <span class="st">"Carol"</span>, <span class="st">"Bob"</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">LastName =</span> <span class="fu">c</span>(<span class="st">"Smith"</span>, <span class="st">"Jones"</span>, <span class="st">"Smith"</span>, <span class="st">"Davis"</span>, <span class="st">"Jones"</span>),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">CourseID =</span> <span class="fu">c</span>(<span class="st">"C101"</span>, <span class="st">"C101"</span>, <span class="st">"C102"</span>, <span class="st">"C103"</span>, <span class="st">"C103"</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">CourseName =</span> <span class="fu">c</span>(<span class="st">"Intro to Math"</span>, <span class="st">"Intro to Math"</span>, <span class="st">"English 101"</span>, <span class="st">"Calculus I"</span>, <span class="st">"Calculus I"</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Credits =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">DepartmentID =</span> <span class="fu">c</span>(<span class="st">"D01"</span>, <span class="st">"D01"</span>, <span class="st">"D02"</span>, <span class="st">"D01"</span>, <span class="st">"D01"</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">DepartmentName =</span> <span class="fu">c</span>(<span class="st">"Mathematics"</span>, <span class="st">"Mathematics"</span>, <span class="st">"English"</span>, <span class="st">"Mathematics"</span>, <span class="st">"Mathematics"</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">DepartmentHead =</span> <span class="fu">c</span>(<span class="st">"Dr. Johnson"</span>, <span class="st">"Dr. Johnson"</span>, <span class="st">"Dr. Williams"</span>, <span class="st">"Dr. Johnson"</span>, <span class="st">"Dr. Johnson"</span>),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">DeptPhone =</span> <span class="fu">c</span>(<span class="st">"(555) 123-4567"</span>, <span class="st">"(555) 123-4567"</span>, <span class="st">"(555) 987-6543"</span>, <span class="st">"(555) 123-4567"</span>, <span class="st">"(555) 123-4567"</span>),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">DeptOffice =</span> <span class="fu">c</span>(<span class="st">"Room A100"</span>, <span class="st">"Room A100"</span>, <span class="st">"Room B200"</span>, <span class="st">"Room A100"</span>, <span class="st">"Room A100"</span>),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Grade =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A-"</span>, <span class="st">"B+"</span>, <span class="st">"C+"</span>),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the non-normalized table</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(first_normal_form, <span class="at">caption =</span> <span class="st">"registration table"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>registration table</caption>
<colgroup>
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 5%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">StudentID</th>
<th style="text-align: left;">FirstName</th>
<th style="text-align: left;">LastName</th>
<th style="text-align: left;">CourseID</th>
<th style="text-align: left;">CourseName</th>
<th style="text-align: right;">Credits</th>
<th style="text-align: left;">DepartmentID</th>
<th style="text-align: left;">DepartmentName</th>
<th style="text-align: left;">DepartmentHead</th>
<th style="text-align: left;">DeptPhone</th>
<th style="text-align: left;">DeptOffice</th>
<th style="text-align: left;">Grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">001</td>
<td style="text-align: left;">Alice</td>
<td style="text-align: left;">Smith</td>
<td style="text-align: left;">C101</td>
<td style="text-align: left;">Intro to Math</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">D01</td>
<td style="text-align: left;">Mathematics</td>
<td style="text-align: left;">Dr.&nbsp;Johnson</td>
<td style="text-align: left;">(555) 123-4567</td>
<td style="text-align: left;">Room A100</td>
<td style="text-align: left;">A</td>
</tr>
<tr class="even">
<td style="text-align: left;">002</td>
<td style="text-align: left;">Bob</td>
<td style="text-align: left;">Jones</td>
<td style="text-align: left;">C101</td>
<td style="text-align: left;">Intro to Math</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">D01</td>
<td style="text-align: left;">Mathematics</td>
<td style="text-align: left;">Dr.&nbsp;Johnson</td>
<td style="text-align: left;">(555) 123-4567</td>
<td style="text-align: left;">Room A100</td>
<td style="text-align: left;">B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">001</td>
<td style="text-align: left;">Alice</td>
<td style="text-align: left;">Smith</td>
<td style="text-align: left;">C102</td>
<td style="text-align: left;">English 101</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">D02</td>
<td style="text-align: left;">English</td>
<td style="text-align: left;">Dr.&nbsp;Williams</td>
<td style="text-align: left;">(555) 987-6543</td>
<td style="text-align: left;">Room B200</td>
<td style="text-align: left;">A-</td>
</tr>
<tr class="even">
<td style="text-align: left;">003</td>
<td style="text-align: left;">Carol</td>
<td style="text-align: left;">Davis</td>
<td style="text-align: left;">C103</td>
<td style="text-align: left;">Calculus I</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">D01</td>
<td style="text-align: left;">Mathematics</td>
<td style="text-align: left;">Dr.&nbsp;Johnson</td>
<td style="text-align: left;">(555) 123-4567</td>
<td style="text-align: left;">Room A100</td>
<td style="text-align: left;">B+</td>
</tr>
<tr class="odd">
<td style="text-align: left;">002</td>
<td style="text-align: left;">Bob</td>
<td style="text-align: left;">Jones</td>
<td style="text-align: left;">C103</td>
<td style="text-align: left;">Calculus I</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">D01</td>
<td style="text-align: left;">Mathematics</td>
<td style="text-align: left;">Dr.&nbsp;Johnson</td>
<td style="text-align: left;">(555) 123-4567</td>
<td style="text-align: left;">Room A100</td>
<td style="text-align: left;">C+</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="the-functional-dependencies-and-primary-key" class="level3" data-number="40.6.1">
<h3 data-number="40.6.1" class="anchored" data-anchor-id="the-functional-dependencies-and-primary-key"><span class="header-section-number">40.6.1</span> The functional dependencies and primary key</h3>
<p>Based on our general understanding of how students register for courses in college, the following are the functional dependencies:</p>
<ol type="1">
<li><code>StudentID → FirstName, LastName</code>
<ul>
<li>A student ID uniquely determines the student’s name.</li>
</ul></li>
<li><code>CourseID → CourseName, Credits, DepartmentID</code>
<ul>
<li>A course ID determines the course details.</li>
</ul></li>
<li><code>DepartmentID → DepartmentName, DepartmentHead, DeptPhone, DeptOffice</code>
<ul>
<li>A department ID determines the department details.</li>
</ul></li>
<li><code>StudentID, CourseID → Grade</code>
<ul>
<li>The combination of student and course determines the grade.</li>
</ul></li>
</ol>
<p>The <strong>primary key</strong> is the composite key <strong><code>(StudentID, CourseID)</code></strong> since together they uniquely identify all values in each row.</p>
</section>
</section>
<section id="second-normal-form-2nf" class="level2" data-number="40.7">
<h2 data-number="40.7" class="anchored" data-anchor-id="second-normal-form-2nf"><span class="header-section-number">40.7</span> Second Normal Form (2NF)</h2>
<p>A table is in Second Normal Form (2NF) if:</p>
<ol type="1">
<li><p>It is already in 1NF</p></li>
<li><p>There are no “Partial Functional Dependencies (pFD)” (see below)</p></li>
</ol>
<section id="what-is-a-partial-functional-dependency-pfd" class="level3" data-number="40.7.1">
<h3 data-number="40.7.1" class="anchored" data-anchor-id="what-is-a-partial-functional-dependency-pfd"><span class="header-section-number">40.7.1</span> What is a “Partial Functional Dependency (pFD)” ?</h3>
<p>A Partial Functional Dependency (pFD) is an FD for which the left hand side (LHS) is only part of the primary key (PK).</p>
<p>In our table, the primary key is the composite key <code>(StudentID, CourseID)</code></p>
<p>Therefore the following functional dependencies are “partial functional dependencies” since the LHS of these FDs are only part the primary key.</p>
<ul>
<li><p><code>StudentID → FirstName, LastName</code></p></li>
<li><p><code>CourseID → CourseName, Credits, DepartmentID</code></p></li>
</ul>
<p>To achieve 2NF, we need to remove these partial dependencies by creating separate tables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Student table (2NF)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>student_2nf <span class="ot">&lt;-</span> first_normal_form <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(StudentID, FirstName, LastName) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create StudentCourse table (2NF)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>student_course_2nf <span class="ot">&lt;-</span> first_normal_form <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(StudentID, CourseID, Grade)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Course table (2NF but not yet in 3NF)</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>course_2nf <span class="ot">&lt;-</span> first_normal_form <span class="sc">%&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CourseID, CourseName, Credits, DepartmentID, DepartmentName, DepartmentHead, DeptPhone, DeptOffice) <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the 2NF tables</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(student_2nf, <span class="at">caption =</span> <span class="st">"student table"</span>, <span class="at">booktabs=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>student table</caption>
<thead>
<tr class="header">
<th style="text-align: left;">StudentID</th>
<th style="text-align: left;">FirstName</th>
<th style="text-align: left;">LastName</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">001</td>
<td style="text-align: left;">Alice</td>
<td style="text-align: left;">Smith</td>
</tr>
<tr class="even">
<td style="text-align: left;">002</td>
<td style="text-align: left;">Bob</td>
<td style="text-align: left;">Jones</td>
</tr>
<tr class="odd">
<td style="text-align: left;">003</td>
<td style="text-align: left;">Carol</td>
<td style="text-align: left;">Davis</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(student_course_2nf, <span class="at">caption =</span> <span class="st">"registration table"</span>, <span class="at">booktabs=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>registration table</caption>
<thead>
<tr class="header">
<th style="text-align: left;">StudentID</th>
<th style="text-align: left;">CourseID</th>
<th style="text-align: left;">Grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">001</td>
<td style="text-align: left;">C101</td>
<td style="text-align: left;">A</td>
</tr>
<tr class="even">
<td style="text-align: left;">002</td>
<td style="text-align: left;">C101</td>
<td style="text-align: left;">B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">001</td>
<td style="text-align: left;">C102</td>
<td style="text-align: left;">A-</td>
</tr>
<tr class="even">
<td style="text-align: left;">003</td>
<td style="text-align: left;">C103</td>
<td style="text-align: left;">B+</td>
</tr>
<tr class="odd">
<td style="text-align: left;">002</td>
<td style="text-align: left;">C103</td>
<td style="text-align: left;">C+</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(course_2nf, <span class="at">caption =</span> <span class="st">"course table (2NF but not yet in 3NF)"</span>, <span class="at">booktabs=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>course table (2NF but not yet in 3NF)</caption>
<colgroup>
<col style="width: 9%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">CourseID</th>
<th style="text-align: left;">CourseName</th>
<th style="text-align: right;">Credits</th>
<th style="text-align: left;">DepartmentID</th>
<th style="text-align: left;">DepartmentName</th>
<th style="text-align: left;">DepartmentHead</th>
<th style="text-align: left;">DeptPhone</th>
<th style="text-align: left;">DeptOffice</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">C101</td>
<td style="text-align: left;">Intro to Math</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">D01</td>
<td style="text-align: left;">Mathematics</td>
<td style="text-align: left;">Dr.&nbsp;Johnson</td>
<td style="text-align: left;">(555) 123-4567</td>
<td style="text-align: left;">Room A100</td>
</tr>
<tr class="even">
<td style="text-align: left;">C102</td>
<td style="text-align: left;">English 101</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">D02</td>
<td style="text-align: left;">English</td>
<td style="text-align: left;">Dr.&nbsp;Williams</td>
<td style="text-align: left;">(555) 987-6543</td>
<td style="text-align: left;">Room B200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C103</td>
<td style="text-align: left;">Calculus I</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">D01</td>
<td style="text-align: left;">Mathematics</td>
<td style="text-align: left;">Dr.&nbsp;Johnson</td>
<td style="text-align: left;">(555) 123-4567</td>
<td style="text-align: left;">Room A100</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="general-rules-for-how-to-convert-a-table-to-2nf" class="level3" data-number="40.7.2">
<h3 data-number="40.7.2" class="anchored" data-anchor-id="general-rules-for-how-to-convert-a-table-to-2nf"><span class="header-section-number">40.7.2</span> General rules for how to convert a table to 2NF</h3>
<ol type="1">
<li><p>For each partial functional dependency (pFD) create a new table that includes all of the columns from the pFD (choose a name for the new table)</p></li>
<li><p>The PK for the new table will be those columns from the left hand side (LHS) of the pFD</p></li>
<li><p>Remove from the original table those columns that were on the right hand side (RHS) of the pFD</p></li>
<li><p>The columns from the LHS of the PFD will remain in the original table and become a foreign key (FK) to the new table.</p></li>
</ol>
</section>
</section>
<section id="third-normal-form-3nf" class="level2" data-number="40.8">
<h2 data-number="40.8" class="anchored" data-anchor-id="third-normal-form-3nf"><span class="header-section-number">40.8</span> Third Normal Form (3NF)</h2>
<p>A table is in Third Normal Form (3NF) if:</p>
<ol type="1">
<li><p>It is already in 2NF</p></li>
<li><p>It has no “Transitive Functional Dependencies (tFD)” (see next section)</p></li>
</ol>
<section id="what-is-a-transitive-functional-dependency-tfd" class="level3" data-number="40.8.1">
<h3 data-number="40.8.1" class="anchored" data-anchor-id="what-is-a-transitive-functional-dependency-tfd"><span class="header-section-number">40.8.1</span> What is a “Transitive Functional Dependency (tFD)” ?</h3>
<p>A transitive functional dependency occurs when there is an indirect relationship between attributes in a relation. Specifically, it happens when attribute A functionally determines attribute C through another attribute B. Formally, if:</p>
<ul>
<li>A → B (A determines B) and</li>
<li>B → C (B determines C)</li>
</ul>
<p>Then we say that</p>
<ul>
<li>A transitively determines C<br>
</li>
<li>or in other words C is transitively dependent on A through B.</li>
</ul>
<p>In our example since</p>
<ul>
<li><code>CourseID → CourseName, Credits, DepartmentID</code><br>
i.e.&nbsp;CourseID determines DepartmentID</li>
</ul>
<p>and</p>
<ul>
<li><code>DepartmentID → DepartmentName, DepartmentHead, DeptPhone, DeptOffice</code></li>
</ul>
<p>we can infer through the logic of <a href="https://byjus.com/maths/transitive-property/">transitivity</a> that</p>
<ul>
<li><code>CourseID → DepartmentName, DepartmentHead, DeptPhone, DeptOffice</code><br>
<strong>THIS IS A TRANSITIVE FUNCTIONAL DEPENDENCY</strong></li>
</ul>
<p>Notice that the primary key for this version of the courses table is JUST <code>CourseID</code>. This is true since CourseID directly or through indirectly through transitivity determines all columns in the table. Specifically:</p>
<ul>
<li><code>CourseId</code> directly determines <code>CourseName, Credits, DepartmentID</code><br>
</li>
<li><code>CourseId</code> indirectly (through DepartmentID) determines <code>DepartmentName, DepartmentHead, DeptPhone, DeptOffice</code></li>
</ul>
<p>Therefore the Primary Key (PK) of the courses table is JUST <code>CourseId</code> (not CourseId and DeptId). Therefore there is no “Partial Functional Dependency” in this table but there IS a “Transitive Functional Dependency” in this table.</p>
</section>
<section id="convert-the-courses-table-to-be-in-3nf" class="level3" data-number="40.8.2">
<h3 data-number="40.8.2" class="anchored" data-anchor-id="convert-the-courses-table-to-be-in-3nf"><span class="header-section-number">40.8.2</span> Convert the Courses table to be in 3NF</h3>
<p>Again, looking at the Course table, we notice a transitive dependency:</p>
<ul>
<li><code>CourseID → DepartmentID</code> (directly)</li>
<li><code>DepartmentID → DepartmentName, DepartmentHead, DeptPhone, DeptOffice</code> (directly)</li>
<li>Therefore, <code>CourseID → DepartmentName, DepartmentHead, DeptPhone, DeptOffice</code> (transitively)</li>
</ul>
<p>This is a classic transitive dependency where course details transitively determine department details through the DepartmentID. To achieve 3NF, we need to remove this transitive dependency from the course table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Course table (3NF)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>course_3nf <span class="ot">&lt;-</span> course_2nf <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CourseID, CourseName, Credits, DepartmentID) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Department table (3NF)</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>department_3nf <span class="ot">&lt;-</span> course_2nf <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DepartmentID, DepartmentName, DepartmentHead, DeptPhone, DeptOffice) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the 3NF tables</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(course_3nf, <span class="at">caption =</span> <span class="st">"Course Table (3NF)"</span>, <span class="at">booktabs=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Course Table (3NF)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">CourseID</th>
<th style="text-align: left;">CourseName</th>
<th style="text-align: right;">Credits</th>
<th style="text-align: left;">DepartmentID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">C101</td>
<td style="text-align: left;">Intro to Math</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">D01</td>
</tr>
<tr class="even">
<td style="text-align: left;">C102</td>
<td style="text-align: left;">English 101</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">D02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C103</td>
<td style="text-align: left;">Calculus I</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">D01</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(department_3nf, <span class="at">caption =</span> <span class="st">"Department Table (3NF)"</span>, <span class="at">booktabs=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Department Table (3NF)</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DepartmentID</th>
<th style="text-align: left;">DepartmentName</th>
<th style="text-align: left;">DepartmentHead</th>
<th style="text-align: left;">DeptPhone</th>
<th style="text-align: left;">DeptOffice</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">D01</td>
<td style="text-align: left;">Mathematics</td>
<td style="text-align: left;">Dr.&nbsp;Johnson</td>
<td style="text-align: left;">(555) 123-4567</td>
<td style="text-align: left;">Room A100</td>
</tr>
<tr class="even">
<td style="text-align: left;">D02</td>
<td style="text-align: left;">English</td>
<td style="text-align: left;">Dr.&nbsp;Williams</td>
<td style="text-align: left;">(555) 987-6543</td>
<td style="text-align: left;">Room B200</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="the-final-design-of-all-tables-i.e.-the-final-table-schema" class="level2" data-number="40.9">
<h2 data-number="40.9" class="anchored" data-anchor-id="the-final-design-of-all-tables-i.e.-the-final-table-schema"><span class="header-section-number">40.9</span> The final design of all tables (i.e.&nbsp;the final table “schema”)</h2>
<p>The final 3NF versions of the tables are shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the 3NF tables</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(student_2nf, <span class="at">caption =</span> <span class="st">"student table"</span>, <span class="at">booktabs=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>student table</caption>
<thead>
<tr class="header">
<th style="text-align: left;">StudentID</th>
<th style="text-align: left;">FirstName</th>
<th style="text-align: left;">LastName</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">001</td>
<td style="text-align: left;">Alice</td>
<td style="text-align: left;">Smith</td>
</tr>
<tr class="even">
<td style="text-align: left;">002</td>
<td style="text-align: left;">Bob</td>
<td style="text-align: left;">Jones</td>
</tr>
<tr class="odd">
<td style="text-align: left;">003</td>
<td style="text-align: left;">Carol</td>
<td style="text-align: left;">Davis</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(student_course_2nf, <span class="at">caption =</span> <span class="st">"student_course table"</span>, <span class="at">booktabs=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>student_course table</caption>
<thead>
<tr class="header">
<th style="text-align: left;">StudentID</th>
<th style="text-align: left;">CourseID</th>
<th style="text-align: left;">Grade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">001</td>
<td style="text-align: left;">C101</td>
<td style="text-align: left;">A</td>
</tr>
<tr class="even">
<td style="text-align: left;">002</td>
<td style="text-align: left;">C101</td>
<td style="text-align: left;">B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">001</td>
<td style="text-align: left;">C102</td>
<td style="text-align: left;">A-</td>
</tr>
<tr class="even">
<td style="text-align: left;">003</td>
<td style="text-align: left;">C103</td>
<td style="text-align: left;">B+</td>
</tr>
<tr class="odd">
<td style="text-align: left;">002</td>
<td style="text-align: left;">C103</td>
<td style="text-align: left;">C+</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(course_3nf, <span class="at">caption =</span> <span class="st">"course table"</span>, <span class="at">booktabs=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>course table</caption>
<thead>
<tr class="header">
<th style="text-align: left;">CourseID</th>
<th style="text-align: left;">CourseName</th>
<th style="text-align: right;">Credits</th>
<th style="text-align: left;">DepartmentID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">C101</td>
<td style="text-align: left;">Intro to Math</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">D01</td>
</tr>
<tr class="even">
<td style="text-align: left;">C102</td>
<td style="text-align: left;">English 101</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">D02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C103</td>
<td style="text-align: left;">Calculus I</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">D01</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(department_3nf, <span class="at">caption =</span> <span class="st">"department table"</span>, <span class="at">booktabs=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>department table</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DepartmentID</th>
<th style="text-align: left;">DepartmentName</th>
<th style="text-align: left;">DepartmentHead</th>
<th style="text-align: left;">DeptPhone</th>
<th style="text-align: left;">DeptOffice</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">D01</td>
<td style="text-align: left;">Mathematics</td>
<td style="text-align: left;">Dr.&nbsp;Johnson</td>
<td style="text-align: left;">(555) 123-4567</td>
<td style="text-align: left;">Room A100</td>
</tr>
<tr class="even">
<td style="text-align: left;">D02</td>
<td style="text-align: left;">English</td>
<td style="text-align: left;">Dr.&nbsp;Williams</td>
<td style="text-align: left;">(555) 987-6543</td>
<td style="text-align: left;">Room B200</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="general-rules-for-how-to-convert-a-table-to-3nf" class="level3" data-number="40.9.1">
<h3 data-number="40.9.1" class="anchored" data-anchor-id="general-rules-for-how-to-convert-a-table-to-3nf"><span class="header-section-number">40.9.1</span> General rules for how to convert a table to 3NF</h3>
<p>To convert a table to 3NF, given a table that contains the sets of columns A,B,C (where each of A,B,C represents one or more columns) and the following transitivity rules:</p>
<ul>
<li><p>A -&gt; B</p></li>
<li><p>B -&gt; C</p></li>
</ul>
<ol type="1">
<li><p>Create a new table (give it a name) that contains all columns from B and C.</p></li>
<li><p>The columns from B will become the primary key for the new table.</p></li>
<li><p>Remove from the original table the columns represented by C</p></li>
<li><p>The columns represented by B will remain in the original table and will become a foreign key to the new table.</p></li>
</ol>
<!--
### Summary of Our Normalization Process

Let's visualize the relationships between our normalized tables:


::: {.cell}

```{.r .cell-code}
# Display all tables in their final form
cat("Final Normalized Tables:\n\n")
```

::: {.cell-output .cell-output-stdout}

```
Final Normalized Tables:
```


:::

```{.r .cell-code}
cat("StudentCourse Table (Primary Key: StudentID, CourseID):\n")
```

::: {.cell-output .cell-output-stdout}

```
StudentCourse Table (Primary Key: StudentID, CourseID):
```


:::

```{.r .cell-code}
kable(student_course_2nf)
```

::: {.cell-output-display}


|StudentID |CourseID |Grade |
|:---------|:--------|:-----|
|001       |C101     |A     |
|002       |C101     |B     |
|001       |C102     |A-    |
|003       |C103     |B+    |
|002       |C103     |C+    |


:::

```{.r .cell-code}
cat("\n\n")
```

```{.r .cell-code}
cat("Student Table (Primary Key: StudentID):\n")
```

::: {.cell-output .cell-output-stdout}

```
Student Table (Primary Key: StudentID):
```


:::

```{.r .cell-code}
kable(student_2nf)
```

::: {.cell-output-display}


|StudentID |FirstName |LastName |
|:---------|:---------|:--------|
|001       |Alice     |Smith    |
|002       |Bob       |Jones    |
|003       |Carol     |Davis    |


:::

```{.r .cell-code}
cat("\n\n")
```

```{.r .cell-code}
cat("Course Table (Primary Key: CourseID):\n")
```

::: {.cell-output .cell-output-stdout}

```
Course Table (Primary Key: CourseID):
```


:::

```{.r .cell-code}
kable(course_3nf)
```

::: {.cell-output-display}


|CourseID |CourseName    | Credits|DepartmentID |
|:--------|:-------------|-------:|:------------|
|C101     |Intro to Math |       3|D01          |
|C102     |English 101   |       4|D02          |
|C103     |Calculus I    |       4|D01          |


:::

```{.r .cell-code}
cat("\n\n")
```

```{.r .cell-code}
cat("Department Table (Primary Key: DepartmentID):\n")
```

::: {.cell-output .cell-output-stdout}

```
Department Table (Primary Key: DepartmentID):
```


:::

```{.r .cell-code}
kable(department_3nf)
```

::: {.cell-output-display}


|DepartmentID |DepartmentName |DepartmentHead |DeptPhone      |DeptOffice |
|:------------|:--------------|:--------------|:--------------|:----------|
|D01          |Mathematics    |Dr. Johnson    |(555) 123-4567 |Room A100  |
|D02          |English        |Dr. Williams   |(555) 987-6543 |Room B200  |


:::
:::


-->
<!--

::: {.cell}

```{.r .cell-code}
# Join all tables to reconstruct the original data
reconstructed_data <- student_course_2nf %>%
  left_join(student_2nf, by = "StudentID") %>%
  left_join(course_3nf, by = "CourseID") %>%
  left_join(department_3nf, by = "DepartmentID") %>%
  select(StudentID, FirstName, LastName, CourseID, CourseName, Credits, 
         DepartmentID, DepartmentName, DepartmentHead, DeptPhone, DeptOffice, Grade)

# Display the reconstructed data
kable(reconstructed_data, caption = "Reconstructed Data from Normalized Tables")
```

::: {.cell-output-display}


Table: Reconstructed Data from Normalized Tables

|StudentID |FirstName |LastName |CourseID |CourseName    | Credits|DepartmentID |DepartmentName |DepartmentHead |DeptPhone      |DeptOffice |Grade |
|:---------|:---------|:--------|:--------|:-------------|-------:|:------------|:--------------|:--------------|:--------------|:----------|:-----|
|001       |Alice     |Smith    |C101     |Intro to Math |       3|D01          |Mathematics    |Dr. Johnson    |(555) 123-4567 |Room A100  |A     |
|002       |Bob       |Jones    |C101     |Intro to Math |       3|D01          |Mathematics    |Dr. Johnson    |(555) 123-4567 |Room A100  |B     |
|001       |Alice     |Smith    |C102     |English 101   |       4|D02          |English        |Dr. Williams   |(555) 987-6543 |Room B200  |A-    |
|003       |Carol     |Davis    |C103     |Calculus I    |       4|D01          |Mathematics    |Dr. Johnson    |(555) 123-4567 |Room A100  |B+    |
|002       |Bob       |Jones    |C103     |Calculus I    |       4|D01          |Mathematics    |Dr. Johnson    |(555) 123-4567 |Room A100  |C+    |


:::
:::

-->
<!--
### Benefits of Normalization

1. **Eliminating redundancy**: Notice how department information was repeated multiple times in our original table but appears only once in our final 3NF design.

2. **Preventing update anomalies**: If Dr. Johnson's phone number changes, we only need to update one row in the Department table, not multiple rows as in the original table.

3. **Improving data integrity**: Each entity (Student, Course, Department) is modeled in its own table with appropriate primary keys and relationships.

4. **Simplifying queries**: Complex data can be reconstructed using JOIN operations while maintaining a clean, normalized structure.

Each normal form builds upon the previous one, addressing specific types of data redundancy and potential anomalies. By following these normalization principles, you can create database designs that are more efficient, less prone to errors, and easier to maintain.
-->
<!--

# YR TODO - fix all of these examples

## OLD Normal Forms

### 1NF - First Normal Form

For a table to be in First Normal Form (1NF) it must satisfy the 
following requirements:

#### All attributes contain only atomic (indivisible) values

Each **cell** must contain a single, indivisible value — not a list, array, or multiple items.

The following Subjects column contains non-atomic values (a Violation of 1nf)

| StudentID | Subjects       |
|-----------|----------------|
| 001       | Math, Science  |
| 002       | History, Math  |
  
This is converted into 1NF by restructuring in the following way:
  
| StudentID | Subject  |
|-----------|----------|
| 001       | Math     |
| 001       | Science  |
| 002       | History  |
| 002       | Math     |

Each cell now has a single value; the table is in "1st normal form (1NF)".
  
#### There are no repeating groups or arrays

The table structure should not use multiple columns to represent values of the same type.

The following table violates 1NF since there is more than one Product column.

| OrderID | Product1 | Product2 | Product3 |
|---------|----------|----------|----------|
| 1001    | Apple    | Banana   | Orange   |

This is converted into 1NF by restructuring in the following way:

| OrderID | Product  |
|---------|----------|
| 1001    | Apple    |
| 1001    | Banana   |
| 1001    | Orange   |


1NF eliminates duplicate rows and ensures that each cell contains only a single value, not a collection of values.

### 2NF - Second Normal Form - no partial functional dependencies

As we saw above, the following table is in 1NF (atomic values, no repeating groups). 

| StudentID | FirstName | LastName | CourseID | CourseName     | Credits | Grade |
|-----------|-----------|----------|----------|----------------|---------|-------|
| 001       | Alice     | Smith    | C101     | Intro to Math  | 3       | A     |
| 002       | Bob       | Jones    | C101     | Intro to Math  | 3       | B     |
| 001       | Alice     | Smith    | C102     | English 101    | 4       | A-    |

However, let's remember the functional dependency rules. As noted above,
the functional dependencies are:

1. `StudentID → FirstName, LastName`  
   - A student ID uniquely determines the student's name.

2. `CourseID → CourseName, Credits`  
   - A course ID determines the course details.

3. `StudentID, CourseID → Grade`  
    
    or equivalently 
    
   `StudentID, CourseID → FirstName, LastName, CourseName, Credits, Grade`
   
   Which means that `StudentID, CourseID` is the primary key of the table.
  
Notice that 

* The functional dependency

  `StudentID → FirstName, LastName`  
  
  Is included as part of the functional dependency:
  
  `StudentID, CourseID → FirstName, LastName, CourseName, Credits, Grade`

  We say that `StudentID → FirstName, LastName`  is a ***partial*** **functional dependency** (pFD).
  
* Similarly `CourseID → CourseName, Credits` is also a 
  ***partial*** **functional dependency** (pFD).
  

To be in 2nd normal form, a table may not contain any ***partial*** functional dependencies.
Specifically:

**A table is in Second Normal Form if:**

- It is already in 1NF
- All non-key attributes are fully functionally dependent on the 
  ***entire*** primary key (not just part of it)


2NF eliminates partial dependencies by removing attributes that depend on 
only part of a composite primary key. This requires creating separate tables 
for those attributes and the part of the key they depend on.
To put a table into 2NF, you must split up the table into 2 or more tables
in the following way:

For each pFD:

1. Create a new table that contains all of the columns from the pFD.
   
   The columns from the left hand side (LHS) of the pFD become the 
   primary key of this new table.

2. Remove the columns that were on the "right hand side (RHS)" of the 
   pFD from the original table.
   
   The columns from the LHS of the pFD remain in the original table 
   and become a foreign key in the original table.
   



#### Example: 1NF but Not 2NF

The following table is in 1NF (atomic values, no repeating groups) but **not in 2NF** 
because some attributes depend only on part of a composite key.

| StudentID | FirstName | LastName | CourseID | CourseName     | Credits | Grade |
|-----------|-----------|----------|----------|----------------|---------|-------|
| 001       | Alice     | Smith    | C101     | Intro to Math  | 3       | A     |
| 002       | Bob       | Jones    | C101     | Intro to Math  | 3       | B     |
| 001       | Alice     | Smith    | C102     | English 101    | 4       | A-    |

- Composite primary key: `(StudentID, CourseID)`
- **Problem**: `CourseName` and `Credits` depend **only on `CourseID`**, 
  not on the whole key. We say that courseId -> CourseName, Credits is a
  **partial dependency** hence this table violates 2nf


To fix this we can separate this into three different tables:

**StudentCourse Table**

| StudentID | CourseID | Grade |
|-----------|----------|-------|
| 001       | C101     | A     |
| 002       | C101     | B     |
| 001       | C102     | A-    |

**Student Table**

| StudentID | FirstName | LastName |
|-----------|-----------|----------|
| 001       | Alice     | Smith    |
| 002       | Bob       | Jones    |

**Course Table**

| CourseID | CourseName     | Credits |
|----------|----------------|---------|
| C101     | Intro to Math  | 3       |
| C102     | English 101    | 4       |

Now, in each table,  
all non-key attributes depend on the **entire primary key**,  
meeting 2NF requirements.





### 3NF - Third Normal Form

A table is in Third Normal Form if:

- It is already in 2NF
- It has no transitive dependencies (non-key attributes depending on other non-key attributes)

3NF eliminates transitive dependencies by creating separate tables for attributes that depend on non-key attributes. This ensures that every non-key attribute depends directly on the primary key and not on another non-key attribute.

## Normalization Examples

### Example 1: Online Bookstore

#### Example 1 - Functional Dependencies

- BookID → Title, Author, AuthorEmail, Publisher, PublisherAddress, Category, CategoryDescription, Price
- Author → AuthorEmail
- Publisher → PublisherAddress
- Category → CategoryDescription

#### Unnormalized Data


::: {.cell}

```{.r .cell-code}
# Create a CSV file for the unnormalized books data
books_unnormalized <- data.frame(
  BookID = c("B001", "B002", "B003"),
  Title = c("Database Design", "SQL Basics", "Network Security"),
  Author = c("John Smith", "John Smith", "Mary Jones"),
  AuthorEmail = c("john@example.com", "john@example.com", "mary@example.com"),
  Publisher = c("TechPress", "TechPress", "SecureBooks"),
  PublisherAddress = c("123 Tech St, NY", "123 Tech St, NY", "456 Secure Ave, CA"),
  Category = c("Database", "Programming", "Security"),
  CategoryDescription = c("About database systems", "About programming", "About security systems"),
  Price = c(45.99, 39.99, 52.99)
)

# Save to CSV
write.csv(books_unnormalized, "books_unnormalized.csv", row.names = FALSE)

# Read from CSV to demonstrate
books_df <- read.csv("books_unnormalized.csv")
kable(books_df, caption = "Unnormalized Books Table")
```

::: {.cell-output-display}


Table: Unnormalized Books Table

|BookID |Title            |Author     |AuthorEmail      |Publisher   |PublisherAddress   |Category    |CategoryDescription    | Price|
|:------|:----------------|:----------|:----------------|:-----------|:------------------|:-----------|:----------------------|-----:|
|B001   |Database Design  |John Smith |john@example.com |TechPress   |123 Tech St, NY    |Database    |About database systems | 45.99|
|B002   |SQL Basics       |John Smith |john@example.com |TechPress   |123 Tech St, NY    |Programming |About programming      | 39.99|
|B003   |Network Security |Mary Jones |mary@example.com |SecureBooks |456 Secure Ave, CA |Security    |About security systems | 52.99|


:::
:::


#### Example 1 -  1NF

In this case, the data is already in 1NF as it has a primary key (BookID) and all values are atomic.


::: {.cell}

```{.r .cell-code}
# The 1NF table is the same as the unnormalized table for this example
books_1nf <- books_unnormalized
kable(books_1nf, caption = "Books Table in 1NF")
```

::: {.cell-output-display}


Table: Books Table in 1NF

|BookID |Title            |Author     |AuthorEmail      |Publisher   |PublisherAddress   |Category    |CategoryDescription    | Price|
|:------|:----------------|:----------|:----------------|:-----------|:------------------|:-----------|:----------------------|-----:|
|B001   |Database Design  |John Smith |john@example.com |TechPress   |123 Tech St, NY    |Database    |About database systems | 45.99|
|B002   |SQL Basics       |John Smith |john@example.com |TechPress   |123 Tech St, NY    |Programming |About programming      | 39.99|
|B003   |Network Security |Mary Jones |mary@example.com |SecureBooks |456 Secure Ave, CA |Security    |About security systems | 52.99|


:::
:::


#### Example 1 - 2NF

To move to 2NF, we need to separate the data into multiple tables to eliminate partial dependencies.


::: {.cell}

```{.r .cell-code}
# Create the normalized tables for 2NF
books_2nf <- data.frame(
  BookID = c("B001", "B002", "B003"),
  Title = c("Database Design", "SQL Basics", "Network Security"),
  Author = c("John Smith", "John Smith", "Mary Jones"),
  Publisher = c("TechPress", "TechPress", "SecureBooks"),
  Category = c("Database", "Programming", "Security"),
  Price = c(45.99, 39.99, 52.99)
)

authors_2nf <- data.frame(
  Author = c("John Smith", "Mary Jones"),
  AuthorEmail = c("john@example.com", "mary@example.com")
)

publishers_2nf <- data.frame(
  Publisher = c("TechPress", "SecureBooks"),
  PublisherAddress = c("123 Tech St, NY", "456 Secure Ave, CA")
)

categories_2nf <- data.frame(
  Category = c("Database", "Programming", "Security"),
  CategoryDescription = c("About database systems", "About programming", "About security systems")
)

# Save to CSV
write.csv(books_2nf, "books_2nf.csv", row.names = FALSE)
write.csv(authors_2nf, "authors_2nf.csv", row.names = FALSE)
write.csv(publishers_2nf, "publishers_2nf.csv", row.names = FALSE)
write.csv(categories_2nf, "categories_2nf.csv", row.names = FALSE)

# Read from CSV
books_2nf_df <- read.csv("books_2nf.csv")
authors_2nf_df <- read.csv("authors_2nf.csv")
publishers_2nf_df <- read.csv("publishers_2nf.csv")
categories_2nf_df <- read.csv("categories_2nf.csv")

# Display tables
kable(books_2nf_df, caption = "Books Table in 2NF")
```

::: {.cell-output-display}


Table: Books Table in 2NF

|BookID |Title            |Author     |Publisher   |Category    | Price|
|:------|:----------------|:----------|:-----------|:-----------|-----:|
|B001   |Database Design  |John Smith |TechPress   |Database    | 45.99|
|B002   |SQL Basics       |John Smith |TechPress   |Programming | 39.99|
|B003   |Network Security |Mary Jones |SecureBooks |Security    | 52.99|


:::

```{.r .cell-code}
kable(authors_2nf_df, caption = "Authors Table in 2NF")
```

::: {.cell-output-display}


Table: Authors Table in 2NF

|Author     |AuthorEmail      |
|:----------|:----------------|
|John Smith |john@example.com |
|Mary Jones |mary@example.com |


:::

```{.r .cell-code}
kable(publishers_2nf_df, caption = "Publishers Table in 2NF")
```

::: {.cell-output-display}


Table: Publishers Table in 2NF

|Publisher   |PublisherAddress   |
|:-----------|:------------------|
|TechPress   |123 Tech St, NY    |
|SecureBooks |456 Secure Ave, CA |


:::

```{.r .cell-code}
kable(categories_2nf_df, caption = "Categories Table in 2NF")
```

::: {.cell-output-display}


Table: Categories Table in 2NF

|Category    |CategoryDescription    |
|:-----------|:----------------------|
|Database    |About database systems |
|Programming |About programming      |
|Security    |About security systems |


:::
:::


#### Example 1 - 3NF

For this example, the 2NF design is already in 3NF because there are no transitive dependencies.


::: {.cell}

```{.r .cell-code}
# Create SQLite database for the 3NF design
db <- dbConnect(SQLite(), ":memory:")

# Create tables
dbExecute(db, "CREATE TABLE Books (
  BookID TEXT PRIMARY KEY,
  Title TEXT,
  Author TEXT,
  Publisher TEXT,
  Category TEXT,
  Price REAL
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Authors (
  Author TEXT PRIMARY KEY,
  AuthorEmail TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Publishers (
  Publisher TEXT PRIMARY KEY,
  PublisherAddress TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Categories (
  Category TEXT PRIMARY KEY,
  CategoryDescription TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
# Insert data
dbWriteTable(db, "Books", books_2nf_df, append = TRUE)
dbWriteTable(db, "Authors", authors_2nf_df, append = TRUE)
dbWriteTable(db, "Publishers", publishers_2nf_df, append = TRUE)
dbWriteTable(db, "Categories", categories_2nf_df, append = TRUE)

# Query to join data from multiple tables
query <- "
SELECT b.BookID, b.Title, b.Author, a.AuthorEmail, b.Publisher, p.PublisherAddress, 
       b.Category, c.CategoryDescription, b.Price
FROM Books b
JOIN Authors a ON b.Author = a.Author
JOIN Publishers p ON b.Publisher = p.Publisher
JOIN Categories c ON b.Category = c.Category
"

# Execute the query
result <- dbGetQuery(db, query)
kable(result, caption = "Joined Data from 3NF Tables")
```

::: {.cell-output-display}


Table: Joined Data from 3NF Tables

|BookID |Title            |Author     |AuthorEmail      |Publisher   |PublisherAddress   |Category    |CategoryDescription    | Price|
|:------|:----------------|:----------|:----------------|:-----------|:------------------|:-----------|:----------------------|-----:|
|B001   |Database Design  |John Smith |john@example.com |TechPress   |123 Tech St, NY    |Database    |About database systems | 45.99|
|B002   |SQL Basics       |John Smith |john@example.com |TechPress   |123 Tech St, NY    |Programming |About programming      | 39.99|
|B003   |Network Security |Mary Jones |mary@example.com |SecureBooks |456 Secure Ave, CA |Security    |About security systems | 52.99|


:::

```{.r .cell-code}
# Disconnect from database
dbDisconnect(db)
```
:::


### Example 2: University Enrollment

#### Example 2 - Functional Dependencies

Let's identify the functional dependencies (FDs) in our data:
- StudentID → StudentName
- CourseID → CourseName, Credits, InstructorID, Room
- InstructorID → InstructorName, InstructorDept, DeptChairContactInfo
- StudentID, CourseID → Grade

**Unnormalized Data**


::: {.cell}

```{.r .cell-code}
# Create a CSV file for the unnormalized enrollments data
enrollments_unnormalized <- data.frame(
  StudentID = c("S101", "S102", "S101", "S103"),
  StudentName = c("Alice Brown", "Bob Green", "Alice Brown", "Carol White"),
  CourseID = c("C201", "C201", "C202", "C305"),
  CourseName = c("Database Systems", "Database Systems", "Web Programming", "Statistics"),
  InstructorID = c("I301", "I301", "I302", "I405"),
  InstructorName = c("Dr. Smith", "Dr. Smith", "Dr. Johnson", "Dr. Davis"),
  InstructorDept = c("Computer Science", "Computer Science", "Computer Science", "Mathematics"),
  DeptChairContactInfo = c("cs-chair@university.edu", "cs-chair@university.edu", "cs-chair@university.edu", "math-chair@university.edu"),
  Room = c("R105", "R105", "R107", "R201"),
  Credits = c(3, 3, 4, 3),
  Grade = c("A", "B", "B+", "A-")
)

# Save to CSV
write.csv(enrollments_unnormalized, "enrollments_unnormalized.csv", row.names = FALSE)

# Read from CSV
enrollments_df <- read.csv("enrollments_unnormalized.csv")
kable(enrollments_df, caption = "Unnormalized Enrollments Table")
```

::: {.cell-output-display}


Table: Unnormalized Enrollments Table

|StudentID |StudentName |CourseID |CourseName       |InstructorID |InstructorName |InstructorDept   |DeptChairContactInfo      |Room | Credits|Grade |
|:---------|:-----------|:--------|:----------------|:------------|:--------------|:----------------|:-------------------------|:----|-------:|:-----|
|S101      |Alice Brown |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |cs-chair@university.edu   |R105 |       3|A     |
|S102      |Bob Green   |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |cs-chair@university.edu   |R105 |       3|B     |
|S101      |Alice Brown |C202     |Web Programming  |I302         |Dr. Johnson    |Computer Science |cs-chair@university.edu   |R107 |       4|B+    |
|S103      |Carol White |C305     |Statistics       |I405         |Dr. Davis      |Mathematics      |math-chair@university.edu |R201 |       3|A-    |


:::
:::


#### Example 2 - 1NF

The data is already in 1NF as all values are atomic and there are no repeating groups.

#### Example 2 - 2NF

A table is in 2NF if it is in 1NF and no non-prime attribute (an attribute that is not part of any candidate key) is dependent on only a portion of a candidate key.

In our unnormalized table, the primary key is the composite key (StudentID, CourseID), since this combination uniquely identifies each row. Let's identify the partial dependencies:

1. StudentName depends only on StudentID (part of the primary key)
2. CourseName, Credits, InstructorID, and Room depend only on CourseID (part of the primary key)
3. InstructorName, InstructorDept, and DeptChairContactInfo depend only on InstructorID, which itself depends on CourseID

These are all partial dependencies because they depend on only part of the primary key (either StudentID or CourseID alone), not the entire key (StudentID, CourseID). To achieve 2NF, we need to eliminate these partial dependencies by creating separate tables.


::: {.cell}

```{.r .cell-code}
# Create the normalized tables for 2NF
students_2nf <- data.frame(
  StudentID = c("S101", "S102", "S103"),
  StudentName = c("Alice Brown", "Bob Green", "Carol White")
)

courses_2nf <- data.frame(
  CourseID = c("C201", "C202", "C305"),
  CourseName = c("Database Systems", "Web Programming", "Statistics"),
  Credits = c(3, 4, 3),
  InstructorID = c("I301", "I302", "I405"),
  Room = c("R105", "R107", "R201")
)

instructors_2nf <- data.frame(
  InstructorID = c("I301", "I302", "I405"),
  InstructorName = c("Dr. Smith", "Dr. Johnson", "Dr. Davis"),
  InstructorDept = c("Computer Science", "Computer Science", "Mathematics"),
  DeptChairContactInfo = c("cs-chair@university.edu", "cs-chair@university.edu", "math-chair@university.edu")
)

enrollment_2nf <- data.frame(
  StudentID = c("S101", "S102", "S101", "S103"),
  CourseID = c("C201", "C201", "C202", "C305"),
  Grade = c("A", "B", "B+", "A-")
)

# Save to CSV
write.csv(students_2nf, "students_2nf.csv", row.names = FALSE)
write.csv(courses_2nf, "courses_2nf.csv", row.names = FALSE)
write.csv(instructors_2nf, "instructors_2nf.csv", row.names = FALSE)
write.csv(enrollment_2nf, "enrollment_2nf.csv", row.names = FALSE)

# Read from CSV
students_2nf_df <- read.csv("students_2nf.csv")
courses_2nf_df <- read.csv("courses_2nf.csv")
instructors_2nf_df <- read.csv("instructors_2nf.csv")
enrollment_2nf_df <- read.csv("enrollment_2nf.csv")

# Display tables
kable(students_2nf_df, caption = "Students Table in 2NF")
```

::: {.cell-output-display}


Table: Students Table in 2NF

|StudentID |StudentName |
|:---------|:-----------|
|S101      |Alice Brown |
|S102      |Bob Green   |
|S103      |Carol White |


:::

```{.r .cell-code}
kable(courses_2nf_df, caption = "Courses Table in 2NF")
```

::: {.cell-output-display}


Table: Courses Table in 2NF

|CourseID |CourseName       | Credits|InstructorID |Room |
|:--------|:----------------|-------:|:------------|:----|
|C201     |Database Systems |       3|I301         |R105 |
|C202     |Web Programming  |       4|I302         |R107 |
|C305     |Statistics       |       3|I405         |R201 |


:::

```{.r .cell-code}
kable(instructors_2nf_df, caption = "Instructors Table in 2NF")
```

::: {.cell-output-display}


Table: Instructors Table in 2NF

|InstructorID |InstructorName |InstructorDept   |DeptChairContactInfo      |
|:------------|:--------------|:----------------|:-------------------------|
|I301         |Dr. Smith      |Computer Science |cs-chair@university.edu   |
|I302         |Dr. Johnson    |Computer Science |cs-chair@university.edu   |
|I405         |Dr. Davis      |Mathematics      |math-chair@university.edu |


:::

```{.r .cell-code}
kable(enrollment_2nf_df, caption = "Enrollment Table in 2NF")
```

::: {.cell-output-display}


Table: Enrollment Table in 2NF

|StudentID |CourseID |Grade |
|:---------|:--------|:-----|
|S101      |C201     |A     |
|S102      |C201     |B     |
|S101      |C202     |B+    |
|S103      |C305     |A-    |


:::
:::


Now each table has a simple primary key (not composite), and all attributes in each table are fully dependent on the primary key of that table. We've resolved the partial dependencies:
- Students table: StudentName fully depends on StudentID
- Courses table: CourseName, Credits, Room, and InstructorID fully depend on CourseID
- Instructors table: InstructorName, InstructorDept, and DeptChairContactInfo fully depend on InstructorID
- Enrollment table: Grade fully depends on the composite key (StudentID, CourseID)

#### Example 2 - 3NF

A table is in 3NF if it is in 2NF and no non-prime attribute (an attribute that is not part of any candidate key) is transitively dependent on the primary key.

A transitive dependency occurs when one non-key attribute depends on another non-key attribute, which in turn depends on the primary key. In our 2NF schema, we still have transitive dependencies in the Instructors table:

InstructorID → InstructorDept → DeptChairContactInfo

Here, DeptChairContactInfo doesn't directly depend on InstructorID. Instead, it depends on InstructorDept, which depends on InstructorID. This creates a transitive dependency.

Let's look at the data more closely:
- All instructors in the Computer Science department have the same chair contact (cs-chair@university.edu)
- All instructors in the Mathematics department have the same chair contact (math-chair@university.edu)

This indicates that DeptChairContactInfo is really a property of the department, not of the individual instructor. To eliminate this transitive dependency, we need to create a separate Departments table.


::: {.cell}

```{.r .cell-code}
# Create the normalized tables for 3NF 
# Create new Departments table to eliminate transitive dependency
departments_3nf <- data.frame(
  DeptName = c("Computer Science", "Mathematics"),
  DeptChairContactInfo = c("cs-chair@university.edu", "math-chair@university.edu")
)

# Modify Instructors table to remove the transitive dependency
instructors_3nf <- data.frame(
  InstructorID = c("I301", "I302", "I405"),
  InstructorName = c("Dr. Smith", "Dr. Johnson", "Dr. Davis"),
  InstructorDept = c("Computer Science", "Computer Science", "Mathematics")
)

# Other tables remain the same as in 2NF because they don't have transitive dependencies
students_3nf <- students_2nf
courses_3nf <- courses_2nf
enrollment_3nf <- enrollment_2nf

# Save to CSV
write.csv(departments_3nf, "departments_3nf.csv", row.names = FALSE)
write.csv(instructors_3nf, "instructors_3nf.csv", row.names = FALSE)

# Read from CSV
departments_3nf_df <- read.csv("departments_3nf.csv")
instructors_3nf_df <- read.csv("instructors_3nf.csv")

# Display tables
kable(departments_3nf_df, caption = "Departments Table in 3NF")
```

::: {.cell-output-display}


Table: Departments Table in 3NF

|DeptName         |DeptChairContactInfo      |
|:----------------|:-------------------------|
|Computer Science |cs-chair@university.edu   |
|Mathematics      |math-chair@university.edu |


:::

```{.r .cell-code}
kable(instructors_3nf_df, caption = "Instructors Table in 3NF (Modified)")
```

::: {.cell-output-display}


Table: Instructors Table in 3NF (Modified)

|InstructorID |InstructorName |InstructorDept   |
|:------------|:--------------|:----------------|
|I301         |Dr. Smith      |Computer Science |
|I302         |Dr. Johnson    |Computer Science |
|I405         |Dr. Davis      |Mathematics      |


:::

```{.r .cell-code}
# Create SQLite database
db <- dbConnect(SQLite(), ":memory:")

# Create tables
dbExecute(db, "CREATE TABLE Students (
  StudentID TEXT PRIMARY KEY,
  StudentName TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Departments (
  DeptName TEXT PRIMARY KEY,
  DeptChairContactInfo TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Instructors (
  InstructorID TEXT PRIMARY KEY,
  InstructorName TEXT,
  InstructorDept TEXT,
  FOREIGN KEY (InstructorDept) REFERENCES Departments(DeptName)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Courses (
  CourseID TEXT PRIMARY KEY,
  CourseName TEXT,
  Credits INTEGER,
  InstructorID TEXT,
  Room TEXT,
  FOREIGN KEY (InstructorID) REFERENCES Instructors(InstructorID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Enrollment (
  StudentID TEXT,
  CourseID TEXT,
  Grade TEXT,
  PRIMARY KEY (StudentID, CourseID),
  FOREIGN KEY (StudentID) REFERENCES Students(StudentID),
  FOREIGN KEY (CourseID) REFERENCES Courses(CourseID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
# Insert data
dbWriteTable(db, "Students", students_3nf, append = TRUE)
dbWriteTable(db, "Departments", departments_3nf, append = TRUE)
dbWriteTable(db, "Instructors", instructors_3nf, append = TRUE)
dbWriteTable(db, "Courses", courses_3nf, append = TRUE)
dbWriteTable(db, "Enrollment", enrollment_3nf, append = TRUE)

# Query to join data from multiple tables
query <- "
SELECT s.StudentID, s.StudentName, c.CourseID, c.CourseName, 
       i.InstructorID, i.InstructorName, i.InstructorDept, d.DeptChairContactInfo,
       c.Room, c.Credits, e.Grade
FROM Enrollment e
JOIN Students s ON e.StudentID = s.StudentID
JOIN Courses c ON e.CourseID = c.CourseID
JOIN Instructors i ON c.InstructorID = i.InstructorID
JOIN Departments d ON i.InstructorDept = d.DeptName
"

# Execute the query
result <- dbGetQuery(db, query)
kable(result, caption = "Joined Data from 3NF Tables")
```

::: {.cell-output-display}


Table: Joined Data from 3NF Tables

|StudentID |StudentName |CourseID |CourseName       |InstructorID |InstructorName |InstructorDept   |DeptChairContactInfo      |Room | Credits|Grade |
|:---------|:-----------|:--------|:----------------|:------------|:--------------|:----------------|:-------------------------|:----|-------:|:-----|
|S101      |Alice Brown |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |cs-chair@university.edu   |R105 |       3|A     |
|S102      |Bob Green   |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |cs-chair@university.edu   |R105 |       3|B     |
|S101      |Alice Brown |C202     |Web Programming  |I302         |Dr. Johnson    |Computer Science |cs-chair@university.edu   |R107 |       4|B+    |
|S103      |Carol White |C305     |Statistics       |I405         |Dr. Davis      |Mathematics      |math-chair@university.edu |R201 |       3|A-    |


:::

```{.r .cell-code}
# Disconnect from database
dbDisconnect(db)
```
:::


With these changes, all tables are now in 3NF because:

1. They are in 2NF (all non-key attributes are fully functionally dependent on the primary key)

2. There are no transitive dependencies (no non-key attribute depends on another non-key attribute)

In this example, we see that:

- DeptChairContactInfo depends on DeptName (not on InstructorID directly)

- By separating this into a Departments table, we've eliminated the transitive dependency

- The Instructors table now references DeptName, which serves as the primary key in the Departments table

Note that we can still reconstruct the original data by joining these normalized tables, as demonstrated in the final query.


# YR TODO - fix this

### Example 2: University Enrollment

**Unnormalized Data**


::: {.cell}

```{.r .cell-code}
# Create a CSV file for the unnormalized enrollments data
enrollments_unnormalized <- data.frame(
  StudentID = c("S101", "S102", "S101", "S103"),
  StudentName = c("Alice Brown", "Bob Green", "Alice Brown", "Carol White"),
  CourseID = c("C201", "C201", "C202", "C305"),
  CourseName = c("Database Systems", "Database Systems", "Web Programming", "Statistics"),
  InstructorID = c("I301", "I301", "I302", "I405"),
  InstructorName = c("Dr. Smith", "Dr. Smith", "Dr. Johnson", "Dr. Davis"),
  InstructorDept = c("Computer Science", "Computer Science", "Computer Science", "Mathematics"),
  Room = c("R105", "R105", "R107", "R201"),
  Credits = c(3, 3, 4, 3),
  Grade = c("A", "B", "B+", "A-")
)

# Save to CSV
write.csv(enrollments_unnormalized, "enrollments_unnormalized.csv", row.names = FALSE)

# Read from CSV
enrollments_df <- read.csv("enrollments_unnormalized.csv")
kable(enrollments_df, caption = "Unnormalized Enrollments Table")
```

::: {.cell-output-display}


Table: Unnormalized Enrollments Table

|StudentID |StudentName |CourseID |CourseName       |InstructorID |InstructorName |InstructorDept   |Room | Credits|Grade |
|:---------|:-----------|:--------|:----------------|:------------|:--------------|:----------------|:----|-------:|:-----|
|S101      |Alice Brown |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |R105 |       3|A     |
|S102      |Bob Green   |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |R105 |       3|B     |
|S101      |Alice Brown |C202     |Web Programming  |I302         |Dr. Johnson    |Computer Science |R107 |       4|B+    |
|S103      |Carol White |C305     |Statistics       |I405         |Dr. Davis      |Mathematics      |R201 |       3|A-    |


:::
:::


#### Example 2 - Functional Dependencies

Let's identify the functional dependencies (FDs) in our data:

- StudentID → StudentName
- CourseID → CourseName, Credits, InstructorID, Room
- InstructorID → InstructorName, InstructorDept
- StudentID, CourseID → Grade


#### Example 2 - 1NF

The data is already in 1NF as all values are atomic and there are no repeating groups.

#### Example 2 - 2NF

A table is in 2NF if it is in 1NF and no non-prime attribute (an attribute that is not part of any candidate key) is dependent on only a portion of a candidate key.

In our unnormalized table, the primary key is the composite key (StudentID, CourseID), since this combination uniquely identifies each row. Let's identify the partial dependencies:

- StudentID → StudentName

  StudentName depends only on StudentID (part of the primary key)
  
  
- CourseID → CourseName, Credits, InstructorID, Room

  CourseName, Credits, InstructorID, and Room depend only on CourseID (part of the primary key)

- InstructorID → InstructorName, InstructorDept

  InstructorName and InstructorDept depend only on InstructorID, which itself depends on CourseID

These are all partial dependencies because they depend on only part of the primary key (either StudentID or CourseID alone), not the entire key (StudentID, CourseID). To achieve 2NF, we need to eliminate these partial dependencies by creating separate tables.


::: {.cell}

```{.r .cell-code}
# Create the normalized tables for 2NF
students_2nf <- data.frame(
  StudentID = c("S101", "S102", "S103"),
  StudentName = c("Alice Brown", "Bob Green", "Carol White")
)

courses_2nf <- data.frame(
  CourseID = c("C201", "C202", "C305"),
  CourseName = c("Database Systems", "Web Programming", "Statistics"),
  Credits = c(3, 4, 3),
  InstructorID = c("I301", "I302", "I405"),
  Room = c("R105", "R107", "R201")
)

instructors_2nf <- data.frame(
  InstructorID = c("I301", "I302", "I405"),
  InstructorName = c("Dr. Smith", "Dr. Johnson", "Dr. Davis"),
  InstructorDept = c("Computer Science", "Computer Science", "Mathematics")
)

enrollment_2nf <- data.frame(
  StudentID = c("S101", "S102", "S101", "S103"),
  CourseID = c("C201", "C201", "C202", "C305"),
  Grade = c("A", "B", "B+", "A-")
)

# Save to CSV
write.csv(students_2nf, "students_2nf.csv", row.names = FALSE)
write.csv(courses_2nf, "courses_2nf.csv", row.names = FALSE)
write.csv(instructors_2nf, "instructors_2nf.csv", row.names = FALSE)
write.csv(enrollment_2nf, "enrollment_2nf.csv", row.names = FALSE)

# Read from CSV
students_2nf_df <- read.csv("students_2nf.csv")
courses_2nf_df <- read.csv("courses_2nf.csv")
instructors_2nf_df <- read.csv("instructors_2nf.csv")
enrollment_2nf_df <- read.csv("enrollment_2nf.csv")

# Display tables
kable(students_2nf_df, caption = "Students Table in 2NF")
```

::: {.cell-output-display}


Table: Students Table in 2NF

|StudentID |StudentName |
|:---------|:-----------|
|S101      |Alice Brown |
|S102      |Bob Green   |
|S103      |Carol White |


:::

```{.r .cell-code}
kable(courses_2nf_df, caption = "Courses Table in 2NF")
```

::: {.cell-output-display}


Table: Courses Table in 2NF

|CourseID |CourseName       | Credits|InstructorID |Room |
|:--------|:----------------|-------:|:------------|:----|
|C201     |Database Systems |       3|I301         |R105 |
|C202     |Web Programming  |       4|I302         |R107 |
|C305     |Statistics       |       3|I405         |R201 |


:::

```{.r .cell-code}
kable(instructors_2nf_df, caption = "Instructors Table in 2NF")
```

::: {.cell-output-display}


Table: Instructors Table in 2NF

|InstructorID |InstructorName |InstructorDept   |
|:------------|:--------------|:----------------|
|I301         |Dr. Smith      |Computer Science |
|I302         |Dr. Johnson    |Computer Science |
|I405         |Dr. Davis      |Mathematics      |


:::

```{.r .cell-code}
kable(enrollment_2nf_df, caption = "Enrollment Table in 2NF")
```

::: {.cell-output-display}


Table: Enrollment Table in 2NF

|StudentID |CourseID |Grade |
|:---------|:--------|:-----|
|S101      |C201     |A     |
|S102      |C201     |B     |
|S101      |C202     |B+    |
|S103      |C305     |A-    |


:::
:::


Now each table has a simple primary key (not composite), and all attributes in each table are fully dependent on the primary key of that table. We've resolved the partial dependencies:

- Students table: StudentName fully depends on StudentID
- Courses table: CourseName, Credits, Room, and InstructorID fully depend on CourseID
- Instructors table: InstructorName and InstructorDept fully depend on InstructorID
- Enrollment table: Grade fully depends on the composite key (StudentID, CourseID)

#### Example 2 - 3NF

A table is in 3NF if it is in 2NF and no non-prime attribute (an attribute that is not part of any candidate key) is transitively dependent on the primary key.

A transitive dependency occurs when one non-key attribute depends on another non-key attribute, which in turn depends on the primary key. In our 2NF schema, we still have a transitive dependency in the Instructors table:

InstructorID → InstructorDept (InstructorDept depends on InstructorID)

But we can further normalize by recognizing that departments can exist independently of instructors, and multiple instructors can belong to the same department. This creates a transitive dependency:

InstructorID → DeptID → DeptName

To eliminate this transitive dependency, we need to create a separate Departments table and modify the Instructors table to reference DeptID instead of storing DeptName directly.


::: {.cell}

```{.r .cell-code}
# Create the normalized tables for 3NF 
# Create new Departments table to eliminate transitive dependency
departments_3nf <- data.frame(
  DeptID = c("CS", "MATH"),
  DeptName = c("Computer Science", "Mathematics")
)

# Modify Instructors table to reference DeptID instead of storing DeptName directly
instructors_3nf <- data.frame(
  InstructorID = c("I301", "I302", "I405"),
  InstructorName = c("Dr. Smith", "Dr. Johnson", "Dr. Davis"),
  DeptID = c("CS", "CS", "MATH")
)

# Other tables remain the same as in 2NF because they don't have transitive dependencies
students_3nf <- students_2nf
courses_3nf <- courses_2nf
enrollment_3nf <- enrollment_2nf

# Save to CSV
write.csv(departments_3nf, "departments_3nf.csv", row.names = FALSE)
write.csv(instructors_3nf, "instructors_3nf.csv", row.names = FALSE)

# Read from CSV
departments_3nf_df <- read.csv("departments_3nf.csv")
instructors_3nf_df <- read.csv("instructors_3nf.csv")

# Display tables
kable(departments_3nf_df, caption = "Departments Table in 3NF")
```

::: {.cell-output-display}


Table: Departments Table in 3NF

|DeptID |DeptName         |
|:------|:----------------|
|CS     |Computer Science |
|MATH   |Mathematics      |


:::

```{.r .cell-code}
kable(instructors_3nf_df, caption = "Instructors Table in 3NF (Modified)")
```

::: {.cell-output-display}


Table: Instructors Table in 3NF (Modified)

|InstructorID |InstructorName |DeptID |
|:------------|:--------------|:------|
|I301         |Dr. Smith      |CS     |
|I302         |Dr. Johnson    |CS     |
|I405         |Dr. Davis      |MATH   |


:::

```{.r .cell-code}
# Create SQLite database
db <- dbConnect(SQLite(), ":memory:")

# Create tables
dbExecute(db, "CREATE TABLE Students (
  StudentID TEXT PRIMARY KEY,
  StudentName TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Departments (
  DeptID TEXT PRIMARY KEY,
  DeptName TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Instructors (
  InstructorID TEXT PRIMARY KEY,
  InstructorName TEXT,
  DeptID TEXT,
  FOREIGN KEY (DeptID) REFERENCES Departments(DeptID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Courses (
  CourseID TEXT PRIMARY KEY,
  CourseName TEXT,
  Credits INTEGER,
  InstructorID TEXT,
  Room TEXT,
  FOREIGN KEY (InstructorID) REFERENCES Instructors(InstructorID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Enrollment (
  StudentID TEXT,
  CourseID TEXT,
  Grade TEXT,
  PRIMARY KEY (StudentID, CourseID),
  FOREIGN KEY (StudentID) REFERENCES Students(StudentID),
  FOREIGN KEY (CourseID) REFERENCES Courses(CourseID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
# Insert data
dbWriteTable(db, "Students", students_3nf, append = TRUE)
dbWriteTable(db, "Departments", departments_3nf, append = TRUE)
dbWriteTable(db, "Instructors", instructors_3nf, append = TRUE)
dbWriteTable(db, "Courses", courses_3nf, append = TRUE)
dbWriteTable(db, "Enrollment", enrollment_3nf, append = TRUE)

# Query to join data from multiple tables
query <- "
SELECT s.StudentID, s.StudentName, c.CourseID, c.CourseName, 
       i.InstructorID, i.InstructorName, d.DeptName, c.Room, c.Credits, e.Grade
FROM Enrollment e
JOIN Students s ON e.StudentID = s.StudentID
JOIN Courses c ON e.CourseID = c.CourseID
JOIN Instructors i ON c.InstructorID = i.InstructorID
JOIN Departments d ON i.DeptID = d.DeptID
"

# Execute the query
result <- dbGetQuery(db, query)
kable(result, caption = "Joined Data from 3NF Tables")
```

::: {.cell-output-display}


Table: Joined Data from 3NF Tables

|StudentID |StudentName |CourseID |CourseName       |InstructorID |InstructorName |DeptName         |Room | Credits|Grade |
|:---------|:-----------|:--------|:----------------|:------------|:--------------|:----------------|:----|-------:|:-----|
|S101      |Alice Brown |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |R105 |       3|A     |
|S102      |Bob Green   |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |R105 |       3|B     |
|S101      |Alice Brown |C202     |Web Programming  |I302         |Dr. Johnson    |Computer Science |R107 |       4|B+    |
|S103      |Carol White |C305     |Statistics       |I405         |Dr. Davis      |Mathematics      |R201 |       3|A-    |


:::

```{.r .cell-code}
# Disconnect from database
dbDisconnect(db)
```
:::


With these changes, all tables are now in 3NF because:
1. They are in 2NF (all non-key attributes are fully functionally dependent on the primary key)
2. There are no transitive dependencies (no non-key attribute depends on another non-key attribute)

Note that we can still reconstruct the original data by joining these normalized tables, as demonstrated in the final query.








# YR TODO - fix this also

### Example 2: University Enrollment

#### Example 2 - Functional Dependencies

- StudentID → StudentName
- CourseID → CourseName, Credits, InstructorID, Room
- InstructorID → InstructorName, InstructorDept
- StudentID, CourseID → Grade

**Unnormalized Data**


::: {.cell}

```{.r .cell-code}
# Create a CSV file for the unnormalized enrollments data
enrollments_unnormalized <- data.frame(
  StudentID = c("S101", "S102", "S101", "S103"),
  StudentName = c("Alice Brown", "Bob Green", "Alice Brown", "Carol White"),
  CourseID = c("C201", "C201", "C202", "C305"),
  CourseName = c("Database Systems", "Database Systems", "Web Programming", "Statistics"),
  InstructorID = c("I301", "I301", "I302", "I405"),
  InstructorName = c("Dr. Smith", "Dr. Smith", "Dr. Johnson", "Dr. Davis"),
  InstructorDept = c("Computer Science", "Computer Science", "Computer Science", "Mathematics"),
  Room = c("R105", "R105", "R107", "R201"),
  Credits = c(3, 3, 4, 3),
  Grade = c("A", "B", "B+", "A-")
)

# Save to CSV
write.csv(enrollments_unnormalized, "enrollments_unnormalized.csv", row.names = FALSE)

# Read from CSV
enrollments_df <- read.csv("enrollments_unnormalized.csv")
kable(enrollments_df, caption = "Unnormalized Enrollments Table")
```

::: {.cell-output-display}


Table: Unnormalized Enrollments Table

|StudentID |StudentName |CourseID |CourseName       |InstructorID |InstructorName |InstructorDept   |Room | Credits|Grade |
|:---------|:-----------|:--------|:----------------|:------------|:--------------|:----------------|:----|-------:|:-----|
|S101      |Alice Brown |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |R105 |       3|A     |
|S102      |Bob Green   |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |R105 |       3|B     |
|S101      |Alice Brown |C202     |Web Programming  |I302         |Dr. Johnson    |Computer Science |R107 |       4|B+    |
|S103      |Carol White |C305     |Statistics       |I405         |Dr. Davis      |Mathematics      |R201 |       3|A-    |


:::
:::


#### Example 2 - 1NF

The data is already in 1NF as all values are atomic
and there are no repeating groups.

#### Example 2 - 2NF

To move to 2NF, we need to separate the data to eliminate partial dependencies.


::: {.cell}

```{.r .cell-code}
# Create the normalized tables for 2NF
students_2nf <- data.frame(
  StudentID = c("S101", "S102", "S103"),
  StudentName = c("Alice Brown", "Bob Green", "Carol White")
)

courses_2nf <- data.frame(
  CourseID = c("C201", "C202", "C305"),
  CourseName = c("Database Systems", "Web Programming", "Statistics"),
  Credits = c(3, 4, 3),
  InstructorID = c("I301", "I302", "I405"),
  Room = c("R105", "R107", "R201")
)

instructors_2nf <- data.frame(
  InstructorID = c("I301", "I302", "I405"),
  InstructorName = c("Dr. Smith", "Dr. Johnson", "Dr. Davis"),
  InstructorDept = c("Computer Science", "Computer Science", "Mathematics")
)

enrollment_2nf <- data.frame(
  StudentID = c("S101", "S102", "S101", "S103"),
  CourseID = c("C201", "C201", "C202", "C305"),
  Grade = c("A", "B", "B+", "A-")
)

# Save to CSV
write.csv(students_2nf, "students_2nf.csv", row.names = FALSE)
write.csv(courses_2nf, "courses_2nf.csv", row.names = FALSE)
write.csv(instructors_2nf, "instructors_2nf.csv", row.names = FALSE)
write.csv(enrollment_2nf, "enrollment_2nf.csv", row.names = FALSE)

# Read from CSV
students_2nf_df <- read.csv("students_2nf.csv")
courses_2nf_df <- read.csv("courses_2nf.csv")
instructors_2nf_df <- read.csv("instructors_2nf.csv")
enrollment_2nf_df <- read.csv("enrollment_2nf.csv")

# Display tables
kable(students_2nf_df, caption = "Students Table in 2NF")
```

::: {.cell-output-display}


Table: Students Table in 2NF

|StudentID |StudentName |
|:---------|:-----------|
|S101      |Alice Brown |
|S102      |Bob Green   |
|S103      |Carol White |


:::

```{.r .cell-code}
kable(courses_2nf_df, caption = "Courses Table in 2NF")
```

::: {.cell-output-display}


Table: Courses Table in 2NF

|CourseID |CourseName       | Credits|InstructorID |Room |
|:--------|:----------------|-------:|:------------|:----|
|C201     |Database Systems |       3|I301         |R105 |
|C202     |Web Programming  |       4|I302         |R107 |
|C305     |Statistics       |       3|I405         |R201 |


:::

```{.r .cell-code}
kable(instructors_2nf_df, caption = "Instructors Table in 2NF")
```

::: {.cell-output-display}


Table: Instructors Table in 2NF

|InstructorID |InstructorName |InstructorDept   |
|:------------|:--------------|:----------------|
|I301         |Dr. Smith      |Computer Science |
|I302         |Dr. Johnson    |Computer Science |
|I405         |Dr. Davis      |Mathematics      |


:::

```{.r .cell-code}
kable(enrollment_2nf_df, caption = "Enrollment Table in 2NF")
```

::: {.cell-output-display}


Table: Enrollment Table in 2NF

|StudentID |CourseID |Grade |
|:---------|:--------|:-----|
|S101      |C201     |A     |
|S102      |C201     |B     |
|S101      |C202     |B+    |
|S103      |C305     |A-    |


:::
:::


#### Example 2 - 3NF

To move to 3NF, we need to eliminate transitive dependencies.


::: {.cell}

```{.r .cell-code}
# Create the normalized tables for 3NF (Only Courses table needs to be modified)
departments_3nf <- data.frame(
  DeptID = c("CS", "MATH"),
  DeptName = c("Computer Science", "Mathematics")
)

instructors_3nf <- data.frame(
  InstructorID = c("I301", "I302", "I405"),
  InstructorName = c("Dr. Smith", "Dr. Johnson", "Dr. Davis"),
  DeptID = c("CS", "CS", "MATH")
)

# Other tables remain the same as in 2NF
students_3nf <- students_2nf
courses_3nf <- courses_2nf
enrollment_3nf <- enrollment_2nf

# Save to CSV
write.csv(departments_3nf, "departments_3nf.csv", row.names = FALSE)
write.csv(instructors_3nf, "instructors_3nf.csv", row.names = FALSE)

# Read from CSV
departments_3nf_df <- read.csv("departments_3nf.csv")
instructors_3nf_df <- read.csv("instructors_3nf.csv")

# Display tables
kable(departments_3nf_df, caption = "Departments Table in 3NF")
```

::: {.cell-output-display}


Table: Departments Table in 3NF

|DeptID |DeptName         |
|:------|:----------------|
|CS     |Computer Science |
|MATH   |Mathematics      |


:::

```{.r .cell-code}
kable(instructors_3nf_df, caption = "Instructors Table in 3NF (Modified)")
```

::: {.cell-output-display}


Table: Instructors Table in 3NF (Modified)

|InstructorID |InstructorName |DeptID |
|:------------|:--------------|:------|
|I301         |Dr. Smith      |CS     |
|I302         |Dr. Johnson    |CS     |
|I405         |Dr. Davis      |MATH   |


:::

```{.r .cell-code}
# Create SQLite database
db <- dbConnect(SQLite(), ":memory:")

# Create tables
dbExecute(db, "CREATE TABLE Students (
  StudentID TEXT PRIMARY KEY,
  StudentName TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Departments (
  DeptID TEXT PRIMARY KEY,
  DeptName TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Instructors (
  InstructorID TEXT PRIMARY KEY,
  InstructorName TEXT,
  DeptID TEXT,
  FOREIGN KEY (DeptID) REFERENCES Departments(DeptID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Courses (
  CourseID TEXT PRIMARY KEY,
  CourseName TEXT,
  Credits INTEGER,
  InstructorID TEXT,
  Room TEXT,
  FOREIGN KEY (InstructorID) REFERENCES Instructors(InstructorID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Enrollment (
  StudentID TEXT,
  CourseID TEXT,
  Grade TEXT,
  PRIMARY KEY (StudentID, CourseID),
  FOREIGN KEY (StudentID) REFERENCES Students(StudentID),
  FOREIGN KEY (CourseID) REFERENCES Courses(CourseID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
# Insert data
dbWriteTable(db, "Students", students_3nf, append = TRUE)
dbWriteTable(db, "Departments", departments_3nf, append = TRUE)
dbWriteTable(db, "Instructors", instructors_3nf, append = TRUE)
dbWriteTable(db, "Courses", courses_3nf, append = TRUE)
dbWriteTable(db, "Enrollment", enrollment_3nf, append = TRUE)

# Query to join data from multiple tables
query <- "
SELECT s.StudentID, s.StudentName, c.CourseID, c.CourseName, 
       i.InstructorID, i.InstructorName, d.DeptName, c.Room, c.Credits, e.Grade
FROM Enrollment e
JOIN Students s ON e.StudentID = s.StudentID
JOIN Courses c ON e.CourseID = c.CourseID
JOIN Instructors i ON c.InstructorID = i.InstructorID
JOIN Departments d ON i.DeptID = d.DeptID
"

# Execute the query
result <- dbGetQuery(db, query)
kable(result, caption = "Joined Data from 3NF Tables")
```

::: {.cell-output-display}


Table: Joined Data from 3NF Tables

|StudentID |StudentName |CourseID |CourseName       |InstructorID |InstructorName |DeptName         |Room | Credits|Grade |
|:---------|:-----------|:--------|:----------------|:------------|:--------------|:----------------|:----|-------:|:-----|
|S101      |Alice Brown |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |R105 |       3|A     |
|S102      |Bob Green   |C201     |Database Systems |I301         |Dr. Smith      |Computer Science |R105 |       3|B     |
|S101      |Alice Brown |C202     |Web Programming  |I302         |Dr. Johnson    |Computer Science |R107 |       4|B+    |
|S103      |Carol White |C305     |Statistics       |I405         |Dr. Davis      |Mathematics      |R201 |       3|A-    |


:::

```{.r .cell-code}
# Disconnect from database
dbDisconnect(db)
```
:::




### Example 3: Retail Store Inventory

#### Example 3 - Functional Dependencies

- ProductID → ProductName, CategoryID, SupplierID, UnitPrice
- CategoryID → CategoryName
- SupplierID → SupplierName, SupplierContact
- WarehouseID → WarehouseLoc
- ProductID, WarehouseID → Quantity

**Unnormalized Data**


::: {.cell}

```{.r .cell-code}
# Create a CSV file for the unnormalized inventory data
inventory_unnormalized <- data.frame(
  ProductID = c("P1001", "P1002", "P1003", "P1004"),
  ProductName = c("Laptop XS", "Mouse Pro", "Desk Chair", "Coffee Mug"),
  CategoryID = c("C01", "C01", "C02", "C03"),
  CategoryName = c("Electronics", "Electronics", "Furniture", "Kitchenware"),
  SupplierID = c("S01", "S01", "S02", "S03"),
  SupplierName = c("TechSupplies", "TechSupplies", "FurnStore", "HomeGoods"),
  SupplierContact = c("555-1234", "555-1234", "555-5678", "555-9012"),
  WarehouseID = c("W01", "W01", "W02", "W01"),
  WarehouseLoc = c("North", "North", "South", "North"),
  Quantity = c(25, 100, 15, 200),
  UnitPrice = c(899.99, 24.99, 149.99, 8.99)
)

# Save to CSV
write.csv(inventory_unnormalized, "inventory_unnormalized.csv", row.names = FALSE)

# Read from CSV
inventory_df <- read.csv("inventory_unnormalized.csv")
kable(inventory_df, caption = "Unnormalized Inventory Table")
```

::: {.cell-output-display}


Table: Unnormalized Inventory Table

|ProductID |ProductName |CategoryID |CategoryName |SupplierID |SupplierName |SupplierContact |WarehouseID |WarehouseLoc | Quantity| UnitPrice|
|:---------|:-----------|:----------|:------------|:----------|:------------|:---------------|:-----------|:------------|--------:|---------:|
|P1001     |Laptop XS   |C01        |Electronics  |S01        |TechSupplies |555-1234        |W01         |North        |       25|    899.99|
|P1002     |Mouse Pro   |C01        |Electronics  |S01        |TechSupplies |555-1234        |W01         |North        |      100|     24.99|
|P1003     |Desk Chair  |C02        |Furniture    |S02        |FurnStore    |555-5678        |W02         |South        |       15|    149.99|
|P1004     |Coffee Mug  |C03        |Kitchenware  |S03        |HomeGoods    |555-9012        |W01         |North        |      200|      8.99|


:::
:::


#### Example 3 - 1NF

The data is already in 1NF as it has a primary key and all values are atomic.


::: {.cell}

```{.r .cell-code}
# The 1NF table is the same as the unnormalized table
inventory_1nf <- inventory_unnormalized
kable(inventory_1nf, caption = "Inventory Table in 1NF")
```

::: {.cell-output-display}


Table: Inventory Table in 1NF

|ProductID |ProductName |CategoryID |CategoryName |SupplierID |SupplierName |SupplierContact |WarehouseID |WarehouseLoc | Quantity| UnitPrice|
|:---------|:-----------|:----------|:------------|:----------|:------------|:---------------|:-----------|:------------|--------:|---------:|
|P1001     |Laptop XS   |C01        |Electronics  |S01        |TechSupplies |555-1234        |W01         |North        |       25|    899.99|
|P1002     |Mouse Pro   |C01        |Electronics  |S01        |TechSupplies |555-1234        |W01         |North        |      100|     24.99|
|P1003     |Desk Chair  |C02        |Furniture    |S02        |FurnStore    |555-5678        |W02         |South        |       15|    149.99|
|P1004     |Coffee Mug  |C03        |Kitchenware  |S03        |HomeGoods    |555-9012        |W01         |North        |      200|      8.99|


:::
:::


#### Example 3 - 2NF

To move to 2NF, we need to separate the data to eliminate partial dependencies.


::: {.cell}

```{.r .cell-code}
# Create the normalized tables for 2NF
products_2nf <- data.frame(
  ProductID = c("P1001", "P1002", "P1003", "P1004"),
  ProductName = c("Laptop XS", "Mouse Pro", "Desk Chair", "Coffee Mug"),
  CategoryID = c("C01", "C01", "C02", "C03"),
  SupplierID = c("S01", "S01", "S02", "S03"),
  UnitPrice = c(899.99, 24.99, 149.99, 8.99)
)

categories_2nf <- data.frame(
  CategoryID = c("C01", "C02", "C03"),
  CategoryName = c("Electronics", "Furniture", "Kitchenware")
)

suppliers_2nf <- data.frame(
  SupplierID = c("S01", "S02", "S03"),
  SupplierName = c("TechSupplies", "FurnStore", "HomeGoods"),
  SupplierContact = c("555-1234", "555-5678", "555-9012")
)

warehouses_2nf <- data.frame(
  WarehouseID = c("W01", "W02"),
  WarehouseLoc = c("North", "South")
)

inventory_items_2nf <- data.frame(
  ProductID = c("P1001", "P1002", "P1003", "P1004"),
  WarehouseID = c("W01", "W01", "W02", "W01"),
  Quantity = c(25, 100, 15, 200)
)

# Save to CSV
write.csv(products_2nf, "products_2nf.csv", row.names = FALSE)
write.csv(categories_2nf, "categories_2nf.csv", row.names = FALSE)
write.csv(suppliers_2nf, "suppliers_2nf.csv", row.names = FALSE)
write.csv(warehouses_2nf, "warehouses_2nf.csv", row.names = FALSE)
write.csv(inventory_items_2nf, "inventory_items_2nf.csv", row.names = FALSE)

# Read from CSV
products_2nf_df <- read.csv("products_2nf.csv")
categories_2nf_df <- read.csv("categories_2nf.csv")
suppliers_2nf_df <- read.csv("suppliers_2nf.csv")
warehouses_2nf_df <- read.csv("warehouses_2nf.csv")
inventory_items_2nf_df <- read.csv("inventory_items_2nf.csv")

# Display tables
kable(products_2nf_df, caption = "Products Table in 2NF")
```

::: {.cell-output-display}


Table: Products Table in 2NF

|ProductID |ProductName |CategoryID |SupplierID | UnitPrice|
|:---------|:-----------|:----------|:----------|---------:|
|P1001     |Laptop XS   |C01        |S01        |    899.99|
|P1002     |Mouse Pro   |C01        |S01        |     24.99|
|P1003     |Desk Chair  |C02        |S02        |    149.99|
|P1004     |Coffee Mug  |C03        |S03        |      8.99|


:::

```{.r .cell-code}
kable(categories_2nf_df, caption = "Categories Table in 2NF")
```

::: {.cell-output-display}


Table: Categories Table in 2NF

|CategoryID |CategoryName |
|:----------|:------------|
|C01        |Electronics  |
|C02        |Furniture    |
|C03        |Kitchenware  |


:::

```{.r .cell-code}
kable(suppliers_2nf_df, caption = "Suppliers Table in 2NF")
```

::: {.cell-output-display}


Table: Suppliers Table in 2NF

|SupplierID |SupplierName |SupplierContact |
|:----------|:------------|:---------------|
|S01        |TechSupplies |555-1234        |
|S02        |FurnStore    |555-5678        |
|S03        |HomeGoods    |555-9012        |


:::

```{.r .cell-code}
kable(warehouses_2nf_df, caption = "Warehouses Table in 2NF")
```

::: {.cell-output-display}


Table: Warehouses Table in 2NF

|WarehouseID |WarehouseLoc |
|:-----------|:------------|
|W01         |North        |
|W02         |South        |


:::

```{.r .cell-code}
kable(inventory_items_2nf_df, caption = "Inventory Items Table in 2NF")
```

::: {.cell-output-display}


Table: Inventory Items Table in 2NF

|ProductID |WarehouseID | Quantity|
|:---------|:-----------|--------:|
|P1001     |W01         |       25|
|P1002     |W01         |      100|
|P1003     |W02         |       15|
|P1004     |W01         |      200|


:::
:::


#### Example 3 - 3NF

For this example, the 2NF design is already in 3NF because there are no transitive dependencies.


::: {.cell}

```{.r .cell-code}
# Create SQLite database
db <- dbConnect(SQLite(), ":memory:")

# Create tables
dbExecute(db, "CREATE TABLE Categories (
  CategoryID TEXT PRIMARY KEY,
  CategoryName TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Suppliers (
  SupplierID TEXT PRIMARY KEY,
  SupplierName TEXT,
  SupplierContact TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Products (
  ProductID TEXT PRIMARY KEY,
  ProductName TEXT,
  CategoryID TEXT,
  SupplierID TEXT,
  UnitPrice REAL,
  FOREIGN KEY (CategoryID) REFERENCES Categories(CategoryID),
  FOREIGN KEY (SupplierID) REFERENCES Suppliers(SupplierID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Warehouses (
  WarehouseID TEXT PRIMARY KEY,
  WarehouseLoc TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Inventory (
  ProductID TEXT,
  WarehouseID TEXT,
  Quantity INTEGER,
  PRIMARY KEY (ProductID, WarehouseID),
  FOREIGN KEY (ProductID) REFERENCES Products(ProductID),
  FOREIGN KEY (WarehouseID) REFERENCES Warehouses(WarehouseID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
# Insert data
dbWriteTable(db, "Categories", categories_2nf_df, append = TRUE)
dbWriteTable(db, "Suppliers", suppliers_2nf_df, append = TRUE)
dbWriteTable(db, "Products", products_2nf_df, append = TRUE)
dbWriteTable(db, "Warehouses", warehouses_2nf_df, append = TRUE)
dbWriteTable(db, "Inventory", inventory_items_2nf_df, append = TRUE)

# Query to join data from multiple tables
query <- "
SELECT p.ProductID, p.ProductName, c.CategoryID, c.CategoryName, 
       s.SupplierID, s.SupplierName, s.SupplierContact, 
       w.WarehouseID, w.WarehouseLoc, i.Quantity, p.UnitPrice
FROM Products p
JOIN Categories c ON p.CategoryID = c.CategoryID
JOIN Suppliers s ON p.SupplierID = s.SupplierID
JOIN Inventory i ON p.ProductID = i.ProductID
JOIN Warehouses w ON i.WarehouseID = w.WarehouseID
"

# Execute the query
result <- dbGetQuery(db, query)
kable(result, caption = "Joined Data from 3NF Tables")
```

::: {.cell-output-display}


Table: Joined Data from 3NF Tables

|ProductID |ProductName |CategoryID |CategoryName |SupplierID |SupplierName |SupplierContact |WarehouseID |WarehouseLoc | Quantity| UnitPrice|
|:---------|:-----------|:----------|:------------|:----------|:------------|:---------------|:-----------|:------------|--------:|---------:|
|P1001     |Laptop XS   |C01        |Electronics  |S01        |TechSupplies |555-1234        |W01         |North        |       25|    899.99|
|P1002     |Mouse Pro   |C01        |Electronics  |S01        |TechSupplies |555-1234        |W01         |North        |      100|     24.99|
|P1003     |Desk Chair  |C02        |Furniture    |S02        |FurnStore    |555-5678        |W02         |South        |       15|    149.99|
|P1004     |Coffee Mug  |C03        |Kitchenware  |S03        |HomeGoods    |555-9012        |W01         |North        |      200|      8.99|


:::

```{.r .cell-code}
# Disconnect from database
dbDisconnect(db)
```
:::


### Example 4: Medical Clinic

#### Example 4 - Functional Dependencies

- AppointmentID → PatientID, DoctorID, AppointmentDate, Status
- PatientID → PatientName, PatientDOB
- DoctorID → DoctorName, DoctorSpecialty, DeptID
- DeptID → DeptName, DeptLocation

**Unnormalized Data**


::: {.cell}

```{.r .cell-code}
# Create a CSV file for the unnormalized appointments data
appointments_unnormalized <- data.frame(
  AppointmentID = c("A1001", "A1002", "A1003", "A1004"),
  PatientID = c("P101", "P102", "P101", "P103"),
  PatientName = c("John Doe", "Jane Smith", "John Doe", "Sam Johnson"),
  PatientDOB = c("1985-03-12", "1990-07-22", "1985-03-12", "1978-11-05"),
  DoctorID = c("D201", "D202", "D203", "D201"),
  DoctorName = c("Dr. Wilson", "Dr. Brown", "Dr. Miller", "Dr. Wilson"),
  DoctorSpecialty = c("Cardiology", "Pediatrics", "Orthopedics", "Cardiology"),
  DeptID = c("DP01", "DP02", "DP03", "DP01"),
  DeptName = c("Cardiology", "Pediatrics", "Orthopedics", "Cardiology"),
  DeptLocation = c("Floor 3", "Floor 1", "Floor 2", "Floor 3"),
  AppointmentDate = c("2023-06-15", "2023-06-16", "2023-06-18", "2023-06-20"),
  Status = c("Completed", "Scheduled", "Cancelled", "Scheduled")
)

# Save to CSV
write.csv(appointments_unnormalized, "appointments_unnormalized.csv", row.names = FALSE)

# Read from CSV
appointments_df <- read.csv("appointments_unnormalized.csv")
kable(appointments_df, caption = "Unnormalized Appointments Table")
```

::: {.cell-output-display}


Table: Unnormalized Appointments Table

|AppointmentID |PatientID |PatientName |PatientDOB |DoctorID |DoctorName |DoctorSpecialty |DeptID |DeptName    |DeptLocation |AppointmentDate |Status    |
|:-------------|:---------|:-----------|:----------|:--------|:----------|:---------------|:------|:-----------|:------------|:---------------|:---------|
|A1001         |P101      |John Doe    |1985-03-12 |D201     |Dr. Wilson |Cardiology      |DP01   |Cardiology  |Floor 3      |2023-06-15      |Completed |
|A1002         |P102      |Jane Smith  |1990-07-22 |D202     |Dr. Brown  |Pediatrics      |DP02   |Pediatrics  |Floor 1      |2023-06-16      |Scheduled |
|A1003         |P101      |John Doe    |1985-03-12 |D203     |Dr. Miller |Orthopedics     |DP03   |Orthopedics |Floor 2      |2023-06-18      |Cancelled |
|A1004         |P103      |Sam Johnson |1978-11-05 |D201     |Dr. Wilson |Cardiology      |DP01   |Cardiology  |Floor 3      |2023-06-20      |Scheduled |


:::
:::


#### Example 4 - 1NF

The data is already in 1NF as it has a primary key and all values are atomic.


::: {.cell}

```{.r .cell-code}
# The 1NF table is the same as the unnormalized table
appointments_1nf <- appointments_unnormalized
kable(appointments_1nf, caption = "Appointments Table in 1NF")
```

::: {.cell-output-display}


Table: Appointments Table in 1NF

|AppointmentID |PatientID |PatientName |PatientDOB |DoctorID |DoctorName |DoctorSpecialty |DeptID |DeptName    |DeptLocation |AppointmentDate |Status    |
|:-------------|:---------|:-----------|:----------|:--------|:----------|:---------------|:------|:-----------|:------------|:---------------|:---------|
|A1001         |P101      |John Doe    |1985-03-12 |D201     |Dr. Wilson |Cardiology      |DP01   |Cardiology  |Floor 3      |2023-06-15      |Completed |
|A1002         |P102      |Jane Smith  |1990-07-22 |D202     |Dr. Brown  |Pediatrics      |DP02   |Pediatrics  |Floor 1      |2023-06-16      |Scheduled |
|A1003         |P101      |John Doe    |1985-03-12 |D203     |Dr. Miller |Orthopedics     |DP03   |Orthopedics |Floor 2      |2023-06-18      |Cancelled |
|A1004         |P103      |Sam Johnson |1978-11-05 |D201     |Dr. Wilson |Cardiology      |DP01   |Cardiology  |Floor 3      |2023-06-20      |Scheduled |


:::
:::


#### Example 4 - 2NF

To move to 2NF, we need to separate the data to eliminate partial dependencies.


::: {.cell}

```{.r .cell-code}
# Create the normalized tables for 2NF
appointments_2nf <- data.frame(
  AppointmentID = c("A1001", "A1002", "A1003", "A1004"),
  PatientID = c("P101", "P102", "P101", "P103"),
  DoctorID = c("D201", "D202", "D203", "D201"),
  AppointmentDate = c("2023-06-15", "2023-06-16", "2023-06-18", "2023-06-20"),
  Status = c("Completed", "Scheduled", "Cancelled", "Scheduled")
)

patients_2nf <- data.frame(
  PatientID = c("P101", "P102", "P103"),
  PatientName = c("John Doe", "Jane Smith", "Sam Johnson"),
  PatientDOB = c("1985-03-12", "1990-07-22", "1978-11-05")
)

doctors_2nf <- data.frame(
  DoctorID = c("D201", "D202", "D203"),
  DoctorName = c("Dr. Wilson", "Dr. Brown", "Dr. Miller"),
  DoctorSpecialty = c("Cardiology", "Pediatrics", "Orthopedics"),
  DeptID = c("DP01", "DP02", "DP03")
)

departments_2nf <- data.frame(
  DeptID = c("DP01", "DP02", "DP03"),
  DeptName = c("Cardiology", "Pediatrics", "Orthopedics"),
  DeptLocation = c("Floor 3", "Floor 1", "Floor 2")
)

# Save to CSV
write.csv(appointments_2nf, "appointments_2nf.csv", row.names = FALSE)
write.csv(patients_2nf, "patients_2nf.csv", row.names = FALSE)
write.csv(doctors_2nf, "doctors_2nf.csv", row.names = FALSE)
write.csv(departments_2nf, "departments_2nf.csv", row.names = FALSE)

# Read from CSV
appointments_2nf_df <- read.csv("appointments_2nf.csv")
patients_2nf_df <- read.csv("patients_2nf.csv")
doctors_2nf_df <- read.csv("doctors_2nf.csv")
departments_2nf_df <- read.csv("departments_2nf.csv")

# Display tables
kable(appointments_2nf_df, caption = "Appointments Table in 2NF")
```

::: {.cell-output-display}


Table: Appointments Table in 2NF

|AppointmentID |PatientID |DoctorID |AppointmentDate |Status    |
|:-------------|:---------|:--------|:---------------|:---------|
|A1001         |P101      |D201     |2023-06-15      |Completed |
|A1002         |P102      |D202     |2023-06-16      |Scheduled |
|A1003         |P101      |D203     |2023-06-18      |Cancelled |
|A1004         |P103      |D201     |2023-06-20      |Scheduled |


:::

```{.r .cell-code}
kable(patients_2nf_df, caption = "Patients Table in 2NF")
```

::: {.cell-output-display}


Table: Patients Table in 2NF

|PatientID |PatientName |PatientDOB |
|:---------|:-----------|:----------|
|P101      |John Doe    |1985-03-12 |
|P102      |Jane Smith  |1990-07-22 |
|P103      |Sam Johnson |1978-11-05 |


:::

```{.r .cell-code}
kable(doctors_2nf_df, caption = "Doctors Table in 2NF")
```

::: {.cell-output-display}


Table: Doctors Table in 2NF

|DoctorID |DoctorName |DoctorSpecialty |DeptID |
|:--------|:----------|:---------------|:------|
|D201     |Dr. Wilson |Cardiology      |DP01   |
|D202     |Dr. Brown  |Pediatrics      |DP02   |
|D203     |Dr. Miller |Orthopedics     |DP03   |


:::

```{.r .cell-code}
kable(departments_2nf_df, caption = "Departments Table in 2NF")
```

::: {.cell-output-display}


Table: Departments Table in 2NF

|DeptID |DeptName    |DeptLocation |
|:------|:-----------|:------------|
|DP01   |Cardiology  |Floor 3      |
|DP02   |Pediatrics  |Floor 1      |
|DP03   |Orthopedics |Floor 2      |


:::
:::


#### Example 4 - 3NF

For this example, the tables are already in 3NF because there are no transitive dependencies.


::: {.cell}

```{.r .cell-code}
# Create SQLite database
db <- dbConnect(SQLite(), ":memory:")

# Create tables
dbExecute(db, "CREATE TABLE Departments (
  DeptID TEXT PRIMARY KEY,
  DeptName TEXT,
  DeptLocation TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Doctors (
  DoctorID TEXT PRIMARY KEY,
  DoctorName TEXT,
  DoctorSpecialty TEXT,
  DeptID TEXT,
  FOREIGN KEY (DeptID) REFERENCES Departments(DeptID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Patients (
  PatientID TEXT PRIMARY KEY,
  PatientName TEXT,
  PatientDOB TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Appointments (
  AppointmentID TEXT PRIMARY KEY,
  PatientID TEXT,
  DoctorID TEXT,
  AppointmentDate TEXT,
  Status TEXT,
  FOREIGN KEY (PatientID) REFERENCES Patients(PatientID),
  FOREIGN KEY (DoctorID) REFERENCES Doctors(DoctorID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
# Insert data
dbWriteTable(db, "Departments", departments_2nf_df, append = TRUE)
dbWriteTable(db, "Doctors", doctors_2nf_df, append = TRUE)
dbWriteTable(db, "Patients", patients_2nf_df, append = TRUE)
dbWriteTable(db, "Appointments", appointments_2nf_df, append = TRUE)

# Query to join data from multiple tables
query <- "
SELECT a.AppointmentID, a.AppointmentDate, a.Status,
       p.PatientID, p.PatientName, p.PatientDOB,
       d.DoctorID, d.DoctorName, d.DoctorSpecialty,
       dp.DeptID, dp.DeptName, dp.DeptLocation
FROM Appointments a
JOIN Patients p ON a.PatientID = p.PatientID
JOIN Doctors d ON a.DoctorID = d.DoctorID
JOIN Departments dp ON d.DeptID = dp.DeptID"


# Execute the query
result <- dbGetQuery(db, query)
kable(result, caption = "Joined Data from 3NF Tables")
```

::: {.cell-output-display}


Table: Joined Data from 3NF Tables

|AppointmentID |AppointmentDate |Status    |PatientID |PatientName |PatientDOB |DoctorID |DoctorName |DoctorSpecialty |DeptID |DeptName    |DeptLocation |
|:-------------|:---------------|:---------|:---------|:-----------|:----------|:--------|:----------|:---------------|:------|:-----------|:------------|
|A1001         |2023-06-15      |Completed |P101      |John Doe    |1985-03-12 |D201     |Dr. Wilson |Cardiology      |DP01   |Cardiology  |Floor 3      |
|A1002         |2023-06-16      |Scheduled |P102      |Jane Smith  |1990-07-22 |D202     |Dr. Brown  |Pediatrics      |DP02   |Pediatrics  |Floor 1      |
|A1003         |2023-06-18      |Cancelled |P101      |John Doe    |1985-03-12 |D203     |Dr. Miller |Orthopedics     |DP03   |Orthopedics |Floor 2      |
|A1004         |2023-06-20      |Scheduled |P103      |Sam Johnson |1978-11-05 |D201     |Dr. Wilson |Cardiology      |DP01   |Cardiology  |Floor 3      |


:::

```{.r .cell-code}
# Disconnect from database
dbDisconnect(db)
```
:::


### Example 5: Hotel Reservations

#### Example 5 - Functional Dependencies

- ReservationID → GuestID, RoomID, CheckInDate, CheckOutDate, PaymentID
- GuestID → GuestName, GuestEmail, GuestPhone
- RoomID → RoomType, RoomRate
- PaymentID → PaymentType, PaymentAmount

#### Example 5 - Unnormalized Data


::: {.cell}

```{.r .cell-code}
# Create a CSV file for the unnormalized reservations data
reservations_unnormalized <- data.frame(
  ReservationID = c("R001", "R002", "R003", "R004"),
  GuestID = c("G101", "G102", "G101", "G103"),
  GuestName = c("Mark Adams", "Susan Lee", "Mark Adams", "Tom Wilson"),
  GuestEmail = c("mark@example.com", "susan@example.com", "mark@example.com", "tom@example.com"),
  GuestPhone = c("555-1111", "555-2222", "555-1111", "555-3333"),
  RoomID = c("RM101", "RM102", "RM201", "RM103"),
  RoomType = c("Deluxe", "Standard", "Suite", "Standard"),
  RoomRate = c(199.99, 149.99, 299.99, 149.99),
  CheckInDate = c("2023-07-10", "2023-07-12", "2023-08-01", "2023-07-15"),
  CheckOutDate = c("2023-07-15", "2023-07-14", "2023-08-05", "2023-07-20"),
  PaymentID = c("P001", "P002", "P003", "P004"),
  PaymentType = c("Credit Card", "PayPal", "Credit Card", "Cash"),
  PaymentAmount = c(999.95, 299.98, 1199.96, 749.95)
)

# Save to CSV
write.csv(reservations_unnormalized, "reservations_unnormalized.csv", row.names = FALSE)

# Read from CSV
reservations_df <- read.csv("reservations_unnormalized.csv")
kable(reservations_df, caption = "Unnormalized Reservations Table")
```

::: {.cell-output-display}


Table: Unnormalized Reservations Table

|ReservationID |GuestID |GuestName  |GuestEmail        |GuestPhone |RoomID |RoomType | RoomRate|CheckInDate |CheckOutDate |PaymentID |PaymentType | PaymentAmount|
|:-------------|:-------|:----------|:-----------------|:----------|:------|:--------|--------:|:-----------|:------------|:---------|:-----------|-------------:|
|R001          |G101    |Mark Adams |mark@example.com  |555-1111   |RM101  |Deluxe   |   199.99|2023-07-10  |2023-07-15   |P001      |Credit Card |        999.95|
|R002          |G102    |Susan Lee  |susan@example.com |555-2222   |RM102  |Standard |   149.99|2023-07-12  |2023-07-14   |P002      |PayPal      |        299.98|
|R003          |G101    |Mark Adams |mark@example.com  |555-1111   |RM201  |Suite    |   299.99|2023-08-01  |2023-08-05   |P003      |Credit Card |       1199.96|
|R004          |G103    |Tom Wilson |tom@example.com   |555-3333   |RM103  |Standard |   149.99|2023-07-15  |2023-07-20   |P004      |Cash        |        749.95|


:::
:::


#### Example 5 - 1NF

The data is already in 1NF as it has a primary key and all values are atomic.


::: {.cell}

```{.r .cell-code}
# The 1NF table is the same as the unnormalized table
reservations_1nf <- reservations_unnormalized
kable(reservations_1nf, caption = "Reservations Table in 1NF")
```

::: {.cell-output-display}


Table: Reservations Table in 1NF

|ReservationID |GuestID |GuestName  |GuestEmail        |GuestPhone |RoomID |RoomType | RoomRate|CheckInDate |CheckOutDate |PaymentID |PaymentType | PaymentAmount|
|:-------------|:-------|:----------|:-----------------|:----------|:------|:--------|--------:|:-----------|:------------|:---------|:-----------|-------------:|
|R001          |G101    |Mark Adams |mark@example.com  |555-1111   |RM101  |Deluxe   |   199.99|2023-07-10  |2023-07-15   |P001      |Credit Card |        999.95|
|R002          |G102    |Susan Lee  |susan@example.com |555-2222   |RM102  |Standard |   149.99|2023-07-12  |2023-07-14   |P002      |PayPal      |        299.98|
|R003          |G101    |Mark Adams |mark@example.com  |555-1111   |RM201  |Suite    |   299.99|2023-08-01  |2023-08-05   |P003      |Credit Card |       1199.96|
|R004          |G103    |Tom Wilson |tom@example.com   |555-3333   |RM103  |Standard |   149.99|2023-07-15  |2023-07-20   |P004      |Cash        |        749.95|


:::
:::


#### Example 5 - 2NF

To move to 2NF, we need to separate the data to eliminate partial dependencies.


::: {.cell}

```{.r .cell-code}
# Create the normalized tables for 2NF
reservations_2nf <- data.frame(
  ReservationID = c("R001", "R002", "R003", "R004"),
  GuestID = c("G101", "G102", "G101", "G103"),
  RoomID = c("RM101", "RM102", "RM201", "RM103"),
  CheckInDate = c("2023-07-10", "2023-07-12", "2023-08-01", "2023-07-15"),
  CheckOutDate = c("2023-07-15", "2023-07-14", "2023-08-05", "2023-07-20"),
  PaymentID = c("P001", "P002", "P003", "P004")
)

guests_2nf <- data.frame(
  GuestID = c("G101", "G102", "G103"),
  GuestName = c("Mark Adams", "Susan Lee", "Tom Wilson"),
  GuestEmail = c("mark@example.com", "susan@example.com", "tom@example.com"),
  GuestPhone = c("555-1111", "555-2222", "555-3333")
)

rooms_2nf <- data.frame(
  RoomID = c("RM101", "RM102", "RM201", "RM103"),
  RoomType = c("Deluxe", "Standard", "Suite", "Standard"),
  RoomRate = c(199.99, 149.99, 299.99, 149.99)
)

payments_2nf <- data.frame(
  PaymentID = c("P001", "P002", "P003", "P004"),
  PaymentType = c("Credit Card", "PayPal", "Credit Card", "Cash"),
  PaymentAmount = c(999.95, 299.98, 1199.96, 749.95)
)

# Save to CSV
write.csv(reservations_2nf, "reservations_2nf.csv", row.names = FALSE)
write.csv(guests_2nf, "guests_2nf.csv", row.names = FALSE)
write.csv(rooms_2nf, "rooms_2nf.csv", row.names = FALSE)
write.csv(payments_2nf, "payments_2nf.csv", row.names = FALSE)

# Read from CSV
reservations_2nf_df <- read.csv("reservations_2nf.csv")
guests_2nf_df <- read.csv("guests_2nf.csv")
rooms_2nf_df <- read.csv("rooms_2nf.csv")
payments_2nf_df <- read.csv("payments_2nf.csv")

# Display tables
kable(reservations_2nf_df, caption = "Reservations Table in 2NF")
```

::: {.cell-output-display}


Table: Reservations Table in 2NF

|ReservationID |GuestID |RoomID |CheckInDate |CheckOutDate |PaymentID |
|:-------------|:-------|:------|:-----------|:------------|:---------|
|R001          |G101    |RM101  |2023-07-10  |2023-07-15   |P001      |
|R002          |G102    |RM102  |2023-07-12  |2023-07-14   |P002      |
|R003          |G101    |RM201  |2023-08-01  |2023-08-05   |P003      |
|R004          |G103    |RM103  |2023-07-15  |2023-07-20   |P004      |


:::

```{.r .cell-code}
kable(guests_2nf_df, caption = "Guests Table in 2NF")
```

::: {.cell-output-display}


Table: Guests Table in 2NF

|GuestID |GuestName  |GuestEmail        |GuestPhone |
|:-------|:----------|:-----------------|:----------|
|G101    |Mark Adams |mark@example.com  |555-1111   |
|G102    |Susan Lee  |susan@example.com |555-2222   |
|G103    |Tom Wilson |tom@example.com   |555-3333   |


:::

```{.r .cell-code}
kable(rooms_2nf_df, caption = "Rooms Table in 2NF")
```

::: {.cell-output-display}


Table: Rooms Table in 2NF

|RoomID |RoomType | RoomRate|
|:------|:--------|--------:|
|RM101  |Deluxe   |   199.99|
|RM102  |Standard |   149.99|
|RM201  |Suite    |   299.99|
|RM103  |Standard |   149.99|


:::

```{.r .cell-code}
kable(payments_2nf_df, caption = "Payments Table in 2NF")
```

::: {.cell-output-display}


Table: Payments Table in 2NF

|PaymentID |PaymentType | PaymentAmount|
|:---------|:-----------|-------------:|
|P001      |Credit Card |        999.95|
|P002      |PayPal      |        299.98|
|P003      |Credit Card |       1199.96|
|P004      |Cash        |        749.95|


:::
:::


#### Example 5 - 3NF

For this example, the 2NF design is already in 3NF because there are no transitive dependencies.


::: {.cell}

```{.r .cell-code}
# Create SQLite database
db <- dbConnect(SQLite(), ":memory:")

# Create tables
dbExecute(db, "CREATE TABLE Guests (
  GuestID TEXT PRIMARY KEY,
  GuestName TEXT,
  GuestEmail TEXT,
  GuestPhone TEXT
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Rooms (
  RoomID TEXT PRIMARY KEY,
  RoomType TEXT,
  RoomRate REAL
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Payments (
  PaymentID TEXT PRIMARY KEY,
  PaymentType TEXT,
  PaymentAmount REAL
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
dbExecute(db, "CREATE TABLE Reservations (
  ReservationID TEXT PRIMARY KEY,
  GuestID TEXT,
  RoomID TEXT,
  CheckInDate TEXT,
  CheckOutDate TEXT,
  PaymentID TEXT,
  FOREIGN KEY (GuestID) REFERENCES Guests(GuestID),
  FOREIGN KEY (RoomID) REFERENCES Rooms(RoomID),
  FOREIGN KEY (PaymentID) REFERENCES Payments(PaymentID)
)")
```

::: {.cell-output .cell-output-stdout}

```
[1] 0
```


:::

```{.r .cell-code}
# Insert data
dbWriteTable(db, "Guests", guests_2nf_df, append = TRUE)
dbWriteTable(db, "Rooms", rooms_2nf_df, append = TRUE)
dbWriteTable(db, "Payments", payments_2nf_df, append = TRUE)
dbWriteTable(db, "Reservations", reservations_2nf_df, append = TRUE)

# Query to join data from multiple tables
query <- "
SELECT r.ReservationID, r.CheckInDate, r.CheckOutDate,
       g.GuestID, g.GuestName, g.GuestEmail, g.GuestPhone,
       rm.RoomID, rm.RoomType, rm.RoomRate,
       p.PaymentID, p.PaymentType, p.PaymentAmount
FROM Reservations r
JOIN Guests g ON r.GuestID = g.GuestID
JOIN Rooms rm ON r.RoomID = rm.RoomID
JOIN Payments p ON r.PaymentID = p.PaymentID
"

# Execute the query
result <- dbGetQuery(db, query)
kable(result, caption = "Joined Data from 3NF Tables")
```

::: {.cell-output-display}


Table: Joined Data from 3NF Tables

|ReservationID |CheckInDate |CheckOutDate |GuestID |GuestName  |GuestEmail        |GuestPhone |RoomID |RoomType | RoomRate|PaymentID |PaymentType | PaymentAmount|
|:-------------|:-----------|:------------|:-------|:----------|:-----------------|:----------|:------|:--------|--------:|:---------|:-----------|-------------:|
|R001          |2023-07-10  |2023-07-15   |G101    |Mark Adams |mark@example.com  |555-1111   |RM101  |Deluxe   |   199.99|P001      |Credit Card |        999.95|
|R002          |2023-07-12  |2023-07-14   |G102    |Susan Lee  |susan@example.com |555-2222   |RM102  |Standard |   149.99|P002      |PayPal      |        299.98|
|R003          |2023-08-01  |2023-08-05   |G101    |Mark Adams |mark@example.com  |555-1111   |RM201  |Suite    |   299.99|P003      |Credit Card |       1199.96|
|R004          |2023-07-15  |2023-07-20   |G103    |Tom Wilson |tom@example.com   |555-3333   |RM103  |Standard |   149.99|P004      |Cash        |        749.95|


:::

```{.r .cell-code}
# Disconnect from database
dbDisconnect(db)
```
:::


-->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./sql0950-workingWithDatabasesInR-v010.html" class="pagination-link" aria-label="<yrChapterNumber>39. </yrChapterNumber> Working directly with databases in R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title"><yrchapternumber>39. </yrchapternumber> Working directly with databases in R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./sql3000-sqlQuestions-v001.html" class="pagination-link" aria-label="<yrChapterNumber>41. </yrChapterNumber> Database Questions (and Answers)">
        <span class="nav-page-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title"><yrchapternumber>41. </yrchapternumber> Database Questions (and Answers)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>
const titles = document.querySelectorAll('.title');

titles.forEach(title => {
  if (title.textContent.trim().startsWith('Appendix')) {
    const chapterNumber = title.querySelector('yrChapterNumber');
    if (chapterNumber) {
      chapterNumber.classList.add('yrAppendixChapterNumber');
    }
  }
});
</script>




</body></html>